<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>frida-labs通关笔记 | wlmt666的博客</title><meta name="author" content="胡楚昊"><meta name="copyright" content="胡楚昊"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="说是打靶场，其实是学习frida 本次所用的靶场是Frida靶场：https:&#x2F;&#x2F;github.com&#x2F;DERE-ad2001&#x2F;Frida-Labs&#x2F;tree&#x2F;main 前言之前一直说要酷酷学习Frida，结果老是没有搞，真的是看不起自己呀！这次说啥也得写了。本博客完结之前会持续更新，目前我的frida功底也是垃圾的一批，所以只作为记录自己学习的日记使用了。 我看到了这个项目：https:&#x2F;&#x2F;gi">
<meta property="og:type" content="article">
<meta property="og:title" content="frida-labs通关笔记">
<meta property="og:url" content="https://wlmt666.top/2026/02/12/frida-labs%E9%80%9A%E5%85%B3%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="wlmt666的博客">
<meta property="og:description" content="说是打靶场，其实是学习frida 本次所用的靶场是Frida靶场：https:&#x2F;&#x2F;github.com&#x2F;DERE-ad2001&#x2F;Frida-Labs&#x2F;tree&#x2F;main 前言之前一直说要酷酷学习Frida，结果老是没有搞，真的是看不起自己呀！这次说啥也得写了。本博客完结之前会持续更新，目前我的frida功底也是垃圾的一批，所以只作为记录自己学习的日记使用了。 我看到了这个项目：https:&#x2F;&#x2F;gi">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wlmt666.top/img/butterfly-icon.png">
<meta property="article:published_time" content="2026-02-12T08:47:45.000Z">
<meta property="article:modified_time" content="2026-02-17T12:52:18.279Z">
<meta property="article:author" content="胡楚昊">
<meta property="article:tag" content="ctf">
<meta property="article:tag" content="reverse">
<meta property="article:tag" content="frida">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wlmt666.top/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "frida-labs通关笔记",
  "url": "https://wlmt666.top/2026/02/12/frida-labs%E9%80%9A%E5%85%B3%E7%AC%94%E8%AE%B0/",
  "image": "https://wlmt666.top/img/butterfly-icon.png",
  "datePublished": "2026-02-12T08:47:45.000Z",
  "dateModified": "2026-02-17T12:52:18.279Z",
  "author": [
    {
      "@type": "Person",
      "name": "胡楚昊",
      "url": "https://wlmt666.top/"
    }
  ]
}</script><link rel="shortcut icon" href="../../../../img/favicon.png"><link rel="canonical" href="https://wlmt666.top/2026/02/12/frida-labs%E9%80%9A%E5%85%B3%E7%AC%94%E8%AE%B0/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="../../../../css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'frida-labs通关笔记',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/modify.css"><link rel="stylesheet" href="/css/wlmt666.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/background.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="../img/butterfly-icon.png" onerror="this.onerror=null;this.src='../img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="../archives/"><div class="headline">文章</div><div class="length-num">9</div></a><a href="../tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="../index.html"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="../tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="../categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="../about"><i class="fa-fw fa fa-user"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="../archives"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="../../../../index.html"><span class="site-name">wlmt666的博客</span></a><a class="nav-page-title" href="../../../../index.html"><span class="site-name">frida-labs通关笔记</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="../index.html"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="../tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="../categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="../about"><i class="fa-fw fa fa-user"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="../archives"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">frida-labs通关笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2026-02-12T08:47:45.000Z" title="发表于 2026-02-12 16:47:45">2026-02-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-17T12:52:18.279Z" title="更新于 2026-02-17 20:52:18">2026-02-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>说是打靶场，其实是学习frida</p>
<p>本次所用的靶场是Frida靶场：<a target="_blank" rel="noopener" href="https://github.com/DERE-ad2001/Frida-Labs/tree/main">https://github.com/DERE-ad2001/Frida-Labs/tree/main</a></p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>之前一直说要酷酷学习Frida，结果老是没有搞，真的是看不起自己呀！这次说啥也得写了。本博客完结之前会持续更新，目前我的frida功底也是垃圾的一批，所以只作为记录自己学习的日记使用了。</p>
<p>我看到了这个项目：<a target="_blank" rel="noopener" href="https://github.com/coffeehb/FridaHook">https://github.com/coffeehb/FridaHook</a> 感觉用来学习frida还不错。另外，我还买了非虫大佬的《frida与协议分析》，可惜落在了学校。相信打完这靶场对于frida的初步理解估计是没什么大问题</p>
<p>我的frida路径：<code>/data/local/tmp</code>配合的是雷电模拟器使用的，可能不定期出bug，所以对于稳定复现我还是惴惴不安的。我的Frida安装是跟着吾爱破解的Andorid逆向教程进行搭建的，一些Xposed环境也是如此。</p>
<p>hook之前的准备工作就不多说了，首先安装完毕frida环境，一定要启动两个终端，一个是adb终端(最高权限)，一个是frida终端。手机或模拟器开启adb调试模式。frida可以和python、go、c等联动，而它hook的核心语言是js，因为其用了QuickJS这个东西，这是在frida.re阅读到的。</p>
<p>有一个小技巧，frida工具包:frida-ps -Uai可以看包名和PID等。</p>
<p>部分题解是参考了：<br><a target="_blank" rel="noopener" href="https://baby-f.github.io/2025/04/20/frida%E5%AD%A6%E4%B9%A0/">frida学习 | 冯宝宝’s Blog</a></p>
<p><a target="_blank" rel="noopener" href="https://zh-closure.github.io/2024/07/12/%E9%80%9A%E8%BF%87Frida-Labs%E5%85%A5%E9%97%A8Frida/#Frida-0x1">通过Frida-Labs入门Frida | Closure</a></p>
<p><a target="_blank" rel="noopener" href="https://gi1gamesh666.github.io/2025/09/07/frida-labs-WP/#0xA">frida-labs WP - APT114514</a></p>
<p>部分知识的获取来自于：<br>[Frida Native层Hook学习笔记 - gla2xy’s blog](<a target="_blank" rel="noopener" href="https://gal2xy.github.io/2024/07/29/Frida">https://gal2xy.github.io/2024/07/29/Frida</a> Hook&#x2F;Frida Native层Hook学习笔记&#x2F;#调用native函数)</p>
<p>实际上官方的仓库也有详细的WP。</p>
<p>相关知识点配合着实践提及了。</p>
<p>考点总结：</p>
<p>0x1：考察java方法重写</p>
<p>0x2：考察调用java含参<strong>静态</strong>方法</p>
<p>0x3：考察hook类的<strong>静态</strong>属性值和<strong>静态</strong>方法</p>
<p>0x4：考察调用java<strong>非静态</strong>含参方法和返回值</p>
<p>0x5：考察调用java已经实例化后的类的方法</p>
<p>0x6：<code>Java.choose</code>和<code>Java.use</code>综合利用</p>
<p>0x7：考察<code>hook</code>java层的构造方法</p>
<p>0x8：hook native层方法参数</p>
<p>0x9：hook native层方法返回值</p>
<p>0xa：主动调用native非导出函数</p>
<p>0xb：动态修改native函数实现</p>
<h1 id="打靶"><a href="#打靶" class="headerlink" title="打靶"></a>打靶</h1><h2 id="Frida-0x1"><a href="#Frida-0x1" class="headerlink" title="Frida 0x1"></a>Frida 0x1</h2><p>进入APP，需要我们输入一个数字，正确才可以通关。</p>
<p>看代码可以选用的工具很多，比如JEB、JADX，和android平台的MT管理器、NP管理器等，我本人则是喜欢jadx。但是为了锻炼自己，这一题选用JEB。以下是我摘录的关键代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这个方法是界面启动的时候的方法，类似于c语言的main函数一样</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle bundle0)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(bundle0);</span><br><span class="line">        <span class="built_in">this</span>.setContentView(layout.activity_main);</span><br><span class="line">        <span class="type">EditText</span> <span class="variable">editText0</span> <span class="operator">=</span> (EditText)<span class="built_in">this</span>.findViewById(id.editTextTextPassword);</span><br><span class="line">        <span class="type">Button</span> <span class="variable">button0</span> <span class="operator">=</span> (Button)<span class="built_in">this</span>.findViewById(id.button);</span><br><span class="line">        <span class="built_in">this</span>.t1 = (TextView)<span class="built_in">this</span>.findViewById(id.textview1);</span><br><span class="line">        button0.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span>  <span class="comment">// android.view.View$OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view0)</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> editText0.getText().toString();</span><br><span class="line">                <span class="keyword">if</span>(TextUtils.isDigitsOnly(s)) &#123;<span class="comment">//必须是数字</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> Integer.parseInt(s);</span><br><span class="line">                    MainActivity.<span class="built_in">this</span>.check(<span class="built_in">this</span>.get_random(), v);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"><span class="comment">//这个方法是check，成功会弹出flag。</span></span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">check</span><span class="params">(<span class="type">int</span> random_num, <span class="type">int</span> input_number)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(random_num * <span class="number">2</span> + <span class="number">4</span> == input_number) &#123;<span class="comment">//关键校验代码</span></span><br><span class="line">            Toast.makeText(<span class="built_in">this</span>.getApplicationContext(), <span class="string">&quot;Yey you guessed it right&quot;</span>, <span class="number">1</span>).show();</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">stringBuilder0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">v2</span> <span class="operator">=</span> <span class="number">0</span>; v2 &lt; <span class="number">20</span>; ++v2) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">v3</span> <span class="operator">=</span> <span class="string">&quot;AMDYV&#123;WVWT_CJJF_0s1&#125;&quot;</span>.charAt(v2);</span><br><span class="line">                <span class="keyword">if</span>(v3 &gt;= <span class="number">97</span> &amp;&amp; v3 &lt;= <span class="number">0x7A</span>) &#123;</span><br><span class="line">                    v3 = (<span class="type">char</span>)(v3 - <span class="number">21</span>);</span><br><span class="line">                    <span class="keyword">if</span>(v3 &lt; <span class="number">97</span>) &#123;</span><br><span class="line">                        v3 = (<span class="type">char</span>)(v3 + <span class="number">26</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(v3 &gt;= <span class="number">65</span> &amp;&amp; v3 &lt;= <span class="number">90</span>) &#123;</span><br><span class="line">                    v3 = (<span class="type">char</span>)(v3 - <span class="number">21</span>);</span><br><span class="line">                    <span class="keyword">if</span>(v3 &lt; <span class="number">65</span>) &#123;</span><br><span class="line">                        v3 = (<span class="type">char</span>)(v3 + <span class="number">26</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                stringBuilder0.append(((<span class="type">char</span>)v3));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.t1.setText(stringBuilder0.toString());<span class="comment">//flag生成逻辑，我们不必分析</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Toast.makeText(<span class="built_in">this</span>.getApplicationContext(), <span class="string">&quot;Try again&quot;</span>, <span class="number">1</span>).show();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//随机数生成，我们要hook的方法</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">get_random</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这里我们可以清晰看到，输入的数字满足<code>random_num * 2 + 4 == input_number</code>就会弹出flag。如果用frida的话，就是hook这个get_random方法即可。这里我们需求很简单，hook随机数生成器，得到随机数后frida终端弹出这个值即可。利用hook，我们可以让值永为固定值，抑或是简单得到值进行运算。</p>
<p>接下来介绍一下hook java层代码的简单逻辑：<br><strong>核心逻辑：</strong></p>
<p>代码必须包裹在<code>Java.perform(function() &#123;</code>大括号之中，可以理解为指定在java平台运行，不加hook会报错。这个perform入参必须是函数。</p>
<p> <code>Java.use()</code>Frida 核心 API，根据“完整类名”获取目标类的操控器, 参数必须是“包名+类名”：比如 <code>com.ad2001.frida0x1.MainActivity</code>：类名必须和 APP 源码中完全一致（区分大小写）</p>
<p>这一步千万不要忘记，我老是忘记，会直接报错的！</p>
<p>对于这部分的获取，JEB可以通过交叉引用窗口的复制功能得到形如<code>6,com.ad2001.frida0x1.MainActivity$1.onClick(android.view.View)+3Ch,,&quot;INVOKE: invoke-virtual Lcom/ad2001/frida0x1/MainActivity;-&gt;getApplicationContext()Landroid/content/Context;, v3&quot;</code>的值，前面的就是目标值。</p>
<p><code>MainActivity.get_random</code>：定位到目标类中的 get_random 方法     implementation是Frida 提供的属性，代表方法的具体执行逻辑    &#x2F;&#x2F; 赋值为新函数：当 APP 调用 get_random() 时，会执行这个新函数，而非原方法</p>
<p>启动的时候，我们要加一个-U，意思是USB调试，-f参数跟包名，这样会重启app，这样执行这个方法就会被我们拦截到，避免拦截不到的情况。这里也是为了方便改输入，因此选择-f启动。网络搜索得知后面一般加一个–no-pause参数表示不暂停程序执行，似乎15版本以后的frida都是默认的了。但是一般CTF比赛用附加模式的多一点。</p>
<table>
<thead>
<tr>
<th>模式类型</th>
<th>对应参数</th>
<th>核心行为</th>
<th>本质</th>
</tr>
</thead>
<tbody><tr>
<td>启动型</td>
<td><code>-f</code></td>
<td>Frida 主动启动目标 APP 进程，再挂载 Hook</td>
<td>从 0 到 1 启动进程</td>
</tr>
<tr>
<td>附加型</td>
<td><code>-p</code>&#x2F;<code>-n</code></td>
<td>附加到<strong>已运行</strong>的目标进程，挂载 Hook</td>
<td>关联已有进程</td>
</tr>
</tbody></table>
<p>写完脚本，假如出现以下错误：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Spawned `com.ad2001.frida0x1`. Resuming main thread!</span><br><span class="line">ReferenceError: &#x27;java&#x27; is not defined</span><br><span class="line">    at &lt;eval&gt; (F:\Desktop\hook.js:1)</span><br></pre></td></tr></table></figure>

<p>说明代码开头j没有大写。</p>
<p><img src="image-20260214211141399.png" alt="image-20260214211141399"></p>
<p>若出现以上回显说明拦截成功</p>
<p><img src="image-20260214211154597.png" alt="image-20260214211154597"></p>
<p>附上EXP：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> hook = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x1.MainActivity&quot;</span>);</span><br><span class="line">  hook.<span class="property">get_random</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hook拦截成功&quot;</span>); <span class="comment">//提示hook成功</span></span><br><span class="line">    <span class="keyword">var</span> i = <span class="variable language_">this</span>.<span class="title function_">get_random</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;返回值是&quot;</span> + i + <span class="string">&quot;\n应该输入&quot;</span> + (i * <span class="number">2</span> + <span class="number">4</span>));</span><br><span class="line">    <span class="keyword">return</span> i; <span class="comment">//必须返回一个原方法应返回的类型</span></span><br><span class="line">    <span class="comment">//return 1;或者返回固定值</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Frida-0x2"><a href="#Frida-0x2" class="headerlink" title="Frida 0x2"></a>Frida 0x2</h2><p>这个程序进去之后就一个”hook me”字样，猜测是需要hook某个关键函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Base64;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.IvParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> TextView t1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">get_flag</span><span class="params">(<span class="type">int</span> a)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(a == <span class="number">4919</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">SecretKeySpec</span> <span class="variable">secretKeySpec0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(<span class="string">&quot;HILLBILLWILLBINN&quot;</span>.getBytes(), <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">                <span class="type">Cipher</span> <span class="variable">cipher0</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES/CBC/PKCS5Padding&quot;</span>);</span><br><span class="line">                cipher0.init(<span class="number">2</span>, secretKeySpec0, <span class="keyword">new</span> <span class="title class_">IvParameterSpec</span>(<span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">16</span>]));</span><br><span class="line">                <span class="type">String</span> <span class="variable">decryptedText</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(cipher0.doFinal(Base64.decode(<span class="string">&quot;q7mBQegjhpfIAr0OgfLvH0t/D0Xi0ieG0vd+8ZVW+b4=&quot;</span>, <span class="number">0</span>)));</span><br><span class="line">                MainActivity.t1.setText(decryptedText);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  <span class="comment">// androidx.fragment.app.FragmentActivity</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="built_in">this</span>.setContentView(layout.activity_main);</span><br><span class="line">        MainActivity.t1 = (TextView)<span class="built_in">this</span>.findViewById(id.textview);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>JEB分析关键函数，显然是需要hook <code>getflag</code>函数。但是实际上我们只需要带参数调用一下这个函数就出来了。怎么带参数调用呢？</p>
<p>上关我们学习到：Java.use创建对象后，可以用implementation重写方法，实际上我们想要调用一个函数，不加这个属性直接调用即可，非常方便，如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> hook = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x2.MainActivity&quot;</span>);</span><br><span class="line">  hook.<span class="title function_">get_flag</span>(<span class="number">4919</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hook成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="image-20260214213043877.png" alt="image-20260214213043877"></p>
<p>这里需要注意启动命令变了，变为了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U -F -l F:\Desktop\hook.js</span><br></pre></td></tr></table></figure>

<p>-F意思是自动附加到一个前台运行的程序，注意这个模式是附加。我们hook的函数会改变mainActivity的字符控件，因此不能在程序刚开始运行就执行hook，这时候MainActivity还没有进行初始化呢！因此不能用0x1的命令了。所以hook的时机也很重要，假如我们hook的函数执行时机是在程序初始化的时候，则不适合用这种方式，应该用0x1演示的spawn模式。</p>
<p>此外还需要注意，因为这个方法没有被程序主动调用，我们hook调用了，他才回显了flag</p>
<h2 id="Frida-0x3"><a href="#Frida-0x3" class="headerlink" title="Frida 0x3"></a>Frida 0x3</h2><p>主界面大概如图所示，提示我们点击按钮。拖进JEB分析一下</p>
<p><img src="image-20260214213640316.png" alt="image-20260214213640316"></p>
<p>主要代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.security.InvalidKeyException;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.BadPaddingException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.IllegalBlockSizeException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.NoSuchPaddingException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    TextView t1;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  <span class="comment">// androidx.fragment.app.FragmentActivity</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="built_in">this</span>.setContentView(layout.activity_main);</span><br><span class="line">        <span class="type">Button</span> <span class="variable">btn</span> <span class="operator">=</span> (Button)<span class="built_in">this</span>.findViewById(id.button);</span><br><span class="line">        <span class="built_in">this</span>.t1 = (TextView)<span class="built_in">this</span>.findViewById(id.textView);</span><br><span class="line">        btn.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span>  <span class="comment">// android.view.View$OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="type">byte</span>[] arr_b1;</span><br><span class="line">                <span class="keyword">if</span>(Checker.code == <span class="number">0x200</span>) &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="built_in">this</span>.getApplicationContext(), <span class="string">&quot;YOU WON!!!&quot;</span>, <span class="number">1</span>).show();</span><br><span class="line">                    <span class="type">SecretKeySpec</span> <span class="variable">secretKeySpec0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(<span class="string">&quot;glass123&quot;</span>.getBytes(), <span class="string">&quot;Blowfish&quot;</span>);</span><br><span class="line">                    <span class="type">byte</span>[] arr_b = Base64.getDecoder().decode(<span class="string">&quot;MKxsZsY9Usw3ozXKKzTF0ymIaC8rs0AY74GnaKqkUrk=&quot;</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="type">Cipher</span> <span class="variable">cipher0</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;Blowfish&quot;</span>);</span><br><span class="line">                        cipher0.init(<span class="number">2</span>, secretKeySpec0);</span><br><span class="line">                        arr_b1 = cipher0.doFinal(arr_b);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">catch</span>(NoSuchAlgorithmException e) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">catch</span>(NoSuchPaddingException e) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">catch</span>(IllegalBlockSizeException e) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">catch</span>(BadPaddingException e) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">catch</span>(InvalidKeyException e) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(arr_b1, Charset.forName(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">                    MainActivity.<span class="built_in">this</span>.t1.setText(s);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Toast.makeText(MainActivity.<span class="built_in">this</span>.getApplicationContext(), <span class="string">&quot;TRY AGAIN&quot;</span>, <span class="number">1</span>).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>实际上checker函数有一个increase函数，可以让code+&#x3D;2。那我们现在存在两个思路：<br>思路1，能否调用100次increase函数</p>
<p>思路2，能否直接给checker赋值</p>
<p>不管哪种思路，我们这次开始hook Checker类，千万不要搞错了。</p>
<p>同时需要注意，这是onClick的点击触发事件，那么哪种启动方式已经没什么区别，因为hook时机始终在用户点击按钮的那一刻</p>
<h3 id="思路1"><a href="#思路1" class="headerlink" title="思路1"></a>思路1</h3><p>我们写一个循环即可，调用方法在02就已经学过了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> hook = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x3.Checker&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;= <span class="number">9999</span>; i++) &#123;</span><br><span class="line">    hook.<span class="title function_">increase</span>();<span class="comment">//这是静态方法</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;当前code的值&quot;</span> + i + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (hook.<span class="property">code</span>.<span class="property">value</span> == <span class="number">0x200</span>) <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hook成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="image-20260214214922236.png" alt="image-20260214214922236"></p>
<h3 id="思路2"><a href="#思路2" class="headerlink" title="思路2"></a>思路2</h3><p>写静态属性和调用函数一样很方便，赋值即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> hook = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x3.Checker&quot;</span>);</span><br><span class="line">  hook.<span class="property">code</span>.<span class="property">value</span> = <span class="number">0x200</span>; <span class="comment">//value表示值，和implementation一样是frida提供的API</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hook成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>附赠一张成功图</p>
<p><img src="image-20260214214707511.png" alt="image-20260214214707511"></p>
<h2 id="Frida-0x4"><a href="#Frida-0x4" class="headerlink" title="Frida 0x4"></a>Frida 0x4</h2><p>进去之后只有一个字符串：hello hackers</p>
<p>还是打开JEB看看代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Check</span> &#123;</span><br><span class="line">    <span class="comment">// 去混淆评级： 低(30)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get_flag</span><span class="params">(<span class="type">int</span> a)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a == <span class="number">0x539</span> ? <span class="string">&quot;FRIDA&#123;XORED_INSTANCE&#125;&quot;</span> : <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里是贴合了CTF了，这不是静态方法，Frida想要调用非静态方法，必须先将其实例化。如果函数只是重写，和01一样，则不需要。豆包的解释如下所示：<br><img src="image-20260214215641057.png" alt="image-20260214215641057"></p>
<p>闲话少说，现在开始介绍如何frida里面将类进行实例化：<code>$new()</code></p>
<p>同时观察代码，我们需要获取的flag是函数返回值，而不是调用函数就万事大吉。</p>
<p>这个是主动调用，时机同样是两个都可以。</p>
<p><img src="image-20260214220327711.png" alt="image-20260214220327711"></p>
<p>exp：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> hook = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x4.Check&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> instance = hook.$new();</span><br><span class="line">  <span class="keyword">var</span> flag = instance.<span class="title function_">get_flag</span>(<span class="number">0x539</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;success,the flag is:&quot;</span> + flag);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Frida-0x5"><a href="#Frida-0x5" class="headerlink" title="Frida 0x5"></a>Frida 0x5</h2><p>点进去还是什么也没有，只有一个Hello World</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.IvParameterSpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    TextView t1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">flag</span><span class="params">(<span class="type">int</span> code)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(code == <span class="number">0x539</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">SecretKeySpec</span> <span class="variable">secretKeySpec0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(<span class="string">&quot;WILLIWOMNKESAWEL&quot;</span>.getBytes(), <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">                <span class="type">Cipher</span> <span class="variable">cipher0</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES/CBC/PKCS5Padding&quot;</span>);</span><br><span class="line">                cipher0.init(<span class="number">2</span>, secretKeySpec0, <span class="keyword">new</span> <span class="title class_">IvParameterSpec</span>(<span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">16</span>]));</span><br><span class="line">                <span class="type">String</span> <span class="variable">decryptedText</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(cipher0.doFinal(Base64.getDecoder().decode(<span class="string">&quot;2Y2YINP9PtJCS/7oq189VzFynmpG8swQDmH4IC9wKAY=&quot;</span>)));</span><br><span class="line">                <span class="built_in">this</span>.t1.setText(decryptedText);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  <span class="comment">// androidx.fragment.app.FragmentActivity</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="built_in">this</span>.setContentView(layout.activity_main);</span><br><span class="line">        <span class="built_in">this</span>.t1 = (TextView)<span class="built_in">this</span>.findViewById(id.textview);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>应该也是要主动调用flag方法，但是需要注意因为这不是静态方法，我们需要先实例化才能修改里面的值。但是这个方法是MainActivity里面的，会被系统自己实例化。我们自己new，反而会报错：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Error: <span class="title">java.lang.RuntimeException</span>: <span class="title">Can</span>&#x27;<span class="title">t</span> <span class="title">create</span> <span class="title">handler</span> <span class="title">inside</span> <span class="title">thread</span> <span class="title">Thread</span>[<span class="title">Thread</span>-3,10,<span class="title">main</span>] <span class="title">that</span> <span class="title">has</span> <span class="title">not</span> <span class="title">called</span> <span class="title">Looper.prepare</span>()</span></span><br><span class="line"><span class="function">    <span class="title">at</span> &lt;<span class="title">anonymous</span>&gt; (<span class="title">frida</span>/<span class="title">node_modules</span>/<span class="title">frida</span>-<span class="title">java</span>-<span class="title">bridge</span>/<span class="title">lib</span>/<span class="title">env.js</span>:124)</span></span><br><span class="line"><span class="function">    <span class="title">at</span> <span class="title">value</span> (<span class="title">frida</span>/<span class="title">node_modules</span>/<span class="title">frida</span>-<span class="title">java</span>-<span class="title">bridge</span>/<span class="title">lib</span>/<span class="title">class</span>-<span class="title">factory.js</span>:1237)</span></span><br><span class="line"><span class="function">    <span class="title">at</span> <span class="title">e</span> (<span class="title">frida</span>/<span class="title">node_modules</span>/<span class="title">frida</span>-<span class="title">java</span>-<span class="title">bridge</span>/<span class="title">lib</span>/<span class="title">class</span>-<span class="title">factory.js</span>:643)</span></span><br><span class="line"><span class="function">    <span class="title">at</span> <span class="title">apply</span> (<span class="title">native</span>)</span></span><br><span class="line"><span class="function">    <span class="title">at</span> <span class="title">value</span> (<span class="title">frida</span>/<span class="title">node_modules</span>/<span class="title">frida</span>-<span class="title">java</span>-<span class="title">bridge</span>/<span class="title">lib</span>/<span class="title">class</span>-<span class="title">factory.js</span>:1141)</span></span><br><span class="line"><span class="function">    <span class="title">at</span> <span class="title">e</span> (<span class="title">frida</span>/<span class="title">node_modules</span>/<span class="title">frida</span>-<span class="title">java</span>-<span class="title">bridge</span>/<span class="title">lib</span>/<span class="title">class</span>-<span class="title">factory.js</span>:610)</span></span><br><span class="line"><span class="function">    <span class="title">at</span> &lt;<span class="title">anonymous</span>&gt; (<span class="title">F</span>:\<span class="title">Desktop</span>\<span class="title">hook.js</span>:3)</span></span><br><span class="line"><span class="function">    <span class="title">at</span> &lt;<span class="title">anonymous</span>&gt; (<span class="title">frida</span>/<span class="title">node_modules</span>/<span class="title">frida</span>-<span class="title">java</span>-<span class="title">bridge</span>/<span class="title">lib</span>/<span class="title">vm.js</span>:12)</span></span><br><span class="line"><span class="function">    <span class="title">at</span> <span class="title">_performPendingVmOps</span> (<span class="title">frida</span>/<span class="title">node_modules</span>/<span class="title">frida</span>-<span class="title">java</span>-<span class="title">bridge</span>/<span class="title">index.js</span>:248)</span></span><br><span class="line"><span class="function">    <span class="title">at</span> &lt;<span class="title">anonymous</span>&gt; (<span class="title">frida</span>/<span class="title">node_modules</span>/<span class="title">frida</span>-<span class="title">java</span>-<span class="title">bridge</span>/<span class="title">index.js</span>:223)</span></span><br><span class="line"><span class="function">    <span class="title">at</span> &lt;<span class="title">anonymous</span>&gt; (<span class="title">frida</span>/<span class="title">node_modules</span>/<span class="title">frida</span>-<span class="title">java</span>-<span class="title">bridge</span>/<span class="title">lib</span>/<span class="title">vm.js</span>:12)</span></span><br><span class="line"><span class="function">    <span class="title">at</span> <span class="title">_performPendingVmOpsWhenReady</span> (<span class="title">frida</span>/<span class="title">node_modules</span>/<span class="title">frida</span>-<span class="title">java</span>-<span class="title">bridge</span>/<span class="title">index.js</span>:242)</span></span><br><span class="line"><span class="function">    <span class="title">at</span> <span class="title">perform</span> (<span class="title">frida</span>/<span class="title">node_modules</span>/<span class="title">frida</span>-<span class="title">java</span>-<span class="title">bridge</span>/<span class="title">index.js</span>:202)</span></span><br><span class="line"><span class="function">    <span class="title">at</span> &lt;<span class="title">eval</span>&gt; (<span class="title">F</span>:\<span class="title">Desktop</span>\<span class="title">hook.js</span>:6)</span></span><br></pre></td></tr></table></figure>

<p>因此我们需要在APP已经实例化完毕的类里面去找实例，然后调用对应的方法，像这种需要用到已经被实例化的对象的方法的情况，可以通过frida的API：Java.choose去筛选。我们可以理解为这是一个搜索引擎，搜索到匹配实例后回调函数放在onMatch语句下面，还可以放一个onComplete用于完成后续任务，搜索结果用M_NEW定义表示。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;目标类完整名&quot;</span>, &#123;</span><br><span class="line">    <span class="comment">// 必选：每匹配到一个实例时触发的回调（键名 onMatch 固定）</span></span><br><span class="line">    <span class="attr">onMatch</span>: <span class="keyword">function</span>(<span class="params">instance</span>) &#123; </span><br><span class="line">        <span class="comment">// 自定义逻辑：操作匹配到的实例（如调用方法、修改字段）</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 可选：枚举完成后触发的回调（键名 onComplete 固定）</span></span><br><span class="line">    <span class="attr">onComplete</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; </span><br><span class="line">        <span class="comment">// 自定义逻辑：如打印枚举结束提示</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这样说可能有点抽象，大家可以结合注释进行阅读：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//java.choose(实例名字,&#123;大括号内写主要函数体&#125;)</span></span><br><span class="line">  <span class="title class_">Java</span>.<span class="title function_">choose</span>(<span class="string">&quot;com.ad2001.frida0x5.MainActivity&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">M_NEW</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;找到了&quot;</span>);</span><br><span class="line">      <span class="variable constant_">M_NEW</span>.<span class="title function_">flag</span>(<span class="number">0x539</span>);</span><br><span class="line">    &#125;, <span class="comment">//大括号内逗号相隔</span></span><br><span class="line">    <span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里我不知道为什么，不加onComplete总会报错，问豆包说是Frida 16.x 以下版本：对「无 onComplete 的 Java.choose」解析逻辑有 bug，尤其在 Android 12+ 设备上，会误判回调配置不完整。但是查阅资料说这是可选的参数，总之我还是写上吧。</p>
<p>依旧放一个成功的照片：</p>
<p><img src="image-20260215152647981.png" alt="image-20260215152647981"></p>
<h2 id="Frida-0x6"><a href="#Frida-0x6" class="headerlink" title="Frida 0x6"></a>Frida 0x6</h2><p>点进去还是啥也没有，和0x5一样。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x6;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> java.security.InvalidKeyException;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.BadPaddingException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.IllegalBlockSizeException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.NoSuchPaddingException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    TextView t1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">get_flag</span><span class="params">(Checker A)</span> <span class="keyword">throws</span> NoSuchPaddingException, NoSuchAlgorithmException, InvalidKeyException, IllegalBlockSizeException, BadPaddingException &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">0x4D2</span> == A.num1 &amp;&amp; <span class="number">0x10E1</span> == A.num2) &#123;</span><br><span class="line">            <span class="type">Cipher</span> <span class="variable">cipher0</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES&quot;</span>);</span><br><span class="line">            cipher0.init(<span class="number">2</span>, <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(<span class="string">&quot;MySecureKey12345&quot;</span>.getBytes(), <span class="string">&quot;AES&quot;</span>));</span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(cipher0.doFinal(Base64.getDecoder().decode(<span class="string">&quot;QQzMj/JNaTblEHnIzgJAQkvWJV2oK9G2/UmrCs85fog=&quot;</span>)));</span><br><span class="line">            <span class="built_in">this</span>.t1.setText(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  <span class="comment">// androidx.fragment.app.FragmentActivity</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="built_in">this</span>.setContentView(layout.activity_main);</span><br><span class="line">        <span class="built_in">this</span>.t1 = (TextView)<span class="built_in">this</span>.findViewById(id.textview);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Checker</span> &#123;</span><br><span class="line">    <span class="type">int</span> num1;</span><br><span class="line">    <span class="type">int</span> num2;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这个代码和第五关总体差不多，但是参数是一个实例。之前我们学习过参数是整数的情况，是直接赋值的，其实这个也大同小异，但是这时候需要我们同时用两个API，因为涉及了两个类，且一个类是实例化后的。</p>
<p>还记得之前hook静态方法我们用到的Java.use接口吗？一句话来说，use用的是class类模板而不是实例，choose是实例。我们这时候用use给checker类赋值，调用main的方法即可美美得到flag。下面是官方解释：</p>
<table>
<thead>
<tr>
<th>接口</th>
<th>官方核心定义</th>
<th>本质作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>Java.use()</code></td>
<td>Dynamically acquire a JavaScript wrapper for a Java class (prototype).</td>
<td>获取 Java 类的<strong>原型包装器</strong>（可理解为「类的模板」），用于 Hook 静态方法、构造方法，或获取类的元信息。</td>
</tr>
<tr>
<td><code>Java.choose()</code></td>
<td>Enumerate live instances of a given Java class in the process’s heap.</td>
<td>枚举进程内存中<strong>已实例化</strong>的该类对象（堆中的真实实例），用于操作已存在的对象实例。</td>
</tr>
</tbody></table>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(function () &#123;</span><br><span class="line">  Java.choose(<span class="string">&quot;com.ad2001.frida0x6.MainActivity&quot;</span>, &#123;</span><br><span class="line">    onMatch: function (M_NEW) &#123;</span><br><span class="line">      console.log(<span class="string">&quot;找到了&quot;</span>);</span><br><span class="line">      <span class="type">var</span> <span class="variable">checker</span> <span class="operator">=</span> Java.use(<span class="string">&quot;com.ad2001.frida0x6.Checker&quot;</span>);</span><br><span class="line">      <span class="comment">//传的参数是实例因此需要先实例化</span></span><br><span class="line">      <span class="type">var</span> <span class="variable">checker_ins</span> <span class="operator">=</span> checker.$<span class="keyword">new</span>();</span><br><span class="line">      checker_ins.num1.value = <span class="number">0x4d2</span>;</span><br><span class="line">      checker_ins.num2.value = <span class="number">0x10e1</span>;</span><br><span class="line">      M_NEW.get_flag(checker_ins);</span><br><span class="line">      console.log(<span class="string">&quot;done&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    onComplete: function () &#123;&#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>成功图：<br><img src="image-20260215154701393.png" alt="image-20260215154701393"></p>
<h2 id="Frida-0x7"><a href="#Frida-0x7" class="headerlink" title="Frida 0x7"></a>Frida 0x7</h2><p>这次进去还是什么也没有</p>
<p>反编译代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x7;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> java.security.InvalidKeyException;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.BadPaddingException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.IllegalBlockSizeException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.NoSuchPaddingException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    TextView t1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">flag</span><span class="params">(Checker A)</span> <span class="keyword">throws</span> NoSuchPaddingException, NoSuchAlgorithmException, InvalidKeyException, IllegalBlockSizeException, BadPaddingException &#123;</span><br><span class="line">        <span class="keyword">if</span>(A.num1 &gt; <span class="number">0x200</span> &amp;&amp; <span class="number">0x200</span> &lt; A.num2) &#123;</span><br><span class="line">            <span class="type">Cipher</span> <span class="variable">cipher0</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES&quot;</span>);</span><br><span class="line">            cipher0.init(<span class="number">2</span>, <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(<span class="string">&quot;MySecureKey12345&quot;</span>.getBytes(), <span class="string">&quot;AES&quot;</span>));</span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(cipher0.doFinal(Base64.getDecoder().decode(<span class="string">&quot;cL/bBqDmfO0IXXJCVFwYLeHp1k3mQr+SP6rlQGUPZTY=&quot;</span>)));</span><br><span class="line">            <span class="built_in">this</span>.t1.setText(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  <span class="comment">// androidx.fragment.app.FragmentActivity</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="built_in">this</span>.setContentView(layout.activity_main);</span><br><span class="line">        <span class="built_in">this</span>.t1 = (TextView)<span class="built_in">this</span>.findViewById(id.textview);</span><br><span class="line">        <span class="type">Checker</span> <span class="variable">checker0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Checker</span>(<span class="number">0x7B</span>, <span class="number">321</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.flag(checker0);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(NoSuchPaddingException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(NoSuchAlgorithmException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(InvalidKeyException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(IllegalBlockSizeException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(BadPaddingException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Checker</span> &#123;</span><br><span class="line">    <span class="type">int</span> num1;</span><br><span class="line">    <span class="type">int</span> num2;</span><br><span class="line"></span><br><span class="line">    Checker(<span class="type">int</span> a, <span class="type">int</span> b) &#123;</span><br><span class="line">        <span class="built_in">this</span>.num1 = a;</span><br><span class="line">        <span class="built_in">this</span>.num2 = b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>发现了吗？这道题相对于上一题，增加了构造方法，而且MainActivity初始化的时候会实例化一个Checker类，它传入的值是不符合要求的。</p>
<p>这里直接用上一题目的脚本会报错，原因是这道题增加了构造方法，会提示参数不匹配。因此new的时候需要传入参数，这就不能直接赋值，而是用构造函数赋值</p>
<p><img src="image-20260215155238625.png" alt="image-20260215155238625"></p>
<p>用构造函数赋值如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Java.perform(function () &#123;</span><br><span class="line">  Java.choose(<span class="string">&quot;com.ad2001.frida0x7.MainActivity&quot;</span>, &#123;</span><br><span class="line">    onMatch: function (M_NEW) &#123;</span><br><span class="line">      console.log(<span class="string">&quot;找到了&quot;</span>);</span><br><span class="line">      <span class="type">var</span> <span class="variable">checker</span> <span class="operator">=</span> Java.use(<span class="string">&quot;com.ad2001.frida0x7.Checker&quot;</span>);</span><br><span class="line">      <span class="comment">//传的参数是实例因此需要先实例化</span></span><br><span class="line">      <span class="type">var</span> <span class="variable">checker_ins</span> <span class="operator">=</span> checker.$<span class="keyword">new</span>(<span class="number">0x201</span>, <span class="number">0x201</span>);</span><br><span class="line">      M_NEW.flag(checker_ins);</span><br><span class="line">      console.log(<span class="string">&quot;done&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    onComplete: function () &#123;&#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="image-20260215155449845.png" alt="image-20260215155449845"></p>
<p>还有思路二，我们可以直接hook构造函数，frida里面用<code>$init</code>表示构造函数，注意调用构造函数参数数量之类的必须和原来的一样，但是外层函数无所谓。即外层function是形式上的，具体如下所示：<br><img src="image-20260215200807149.png" alt="image-20260215200807149"></p>
<p>exp如下：启动方式得选择spawn了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> hook = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.ad2001.frida0x7.Checker&quot;</span>);</span><br><span class="line">  hook.<span class="property">$init</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//外层function参数无所谓</span></span><br><span class="line">    <span class="variable language_">this</span>.$init(<span class="number">0x202</span>, <span class="number">0x201</span>); <span class="comment">//内层调用构造函数参数必须保持一致</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="加餐-hook-java参数"><a href="#加餐-hook-java参数" class="headerlink" title="加餐 hook java参数"></a>加餐 hook java参数</h2><p>frida如何hook java层某方法调用时候的参数呢？<br>其实frida替换方法的时候，那个function()内接受的就是原函数参数，如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">TargetClass</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;包名.类名&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. hook 目标方法（如果有重载，需要用 overload 指定参数类型）</span></span><br><span class="line">    <span class="title class_">TargetClass</span>.目标方法名.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">参数<span class="number">1</span>, 参数<span class="number">2</span>, ...</span>) &#123;</span><br><span class="line">        <span class="comment">// 3. 读取原始参数</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;原始参数1：&quot;</span>, 参数<span class="number">1</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;原始参数2：&quot;</span>, 参数<span class="number">2</span>);</span><br></pre></td></tr></table></figure>



<h2 id="Frida-0x8"><a href="#Frida-0x8" class="headerlink" title="Frida 0x8"></a>Frida 0x8</h2><p>打开之后，存在一个文本框控件 ，且存在一个提交按钮。输入错误之后，则会提示我们再次尝试</p>
<p><img src="image-20260215201101288.png" alt="image-20260215201101288"></p>
<p>我们现在看源代码有没有什么提示信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0x8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> com.ad2001.frida0x8.databinding.ActivityMainBinding;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ActivityMainBinding binding;</span><br><span class="line">    Button btn;</span><br><span class="line">    EditText edt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;frida0x8&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">int</span> <span class="title function_">cmpstr</span><span class="params">(String arg1)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  <span class="comment">// androidx.fragment.app.FragmentActivity</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="type">ActivityMainBinding</span> <span class="variable">activityMainBinding0</span> <span class="operator">=</span> ActivityMainBinding.inflate(<span class="built_in">this</span>.getLayoutInflater());</span><br><span class="line">        <span class="built_in">this</span>.binding = activityMainBinding0;</span><br><span class="line">        <span class="built_in">this</span>.setContentView(activityMainBinding0.getRoot());</span><br><span class="line">        <span class="built_in">this</span>.edt = (EditText)<span class="built_in">this</span>.findViewById(id.editTextText);</span><br><span class="line">        <span class="type">Button</span> <span class="variable">button0</span> <span class="operator">=</span> (Button)<span class="built_in">this</span>.findViewById(id.button);</span><br><span class="line">        <span class="built_in">this</span>.btn = button0;</span><br><span class="line">        button0.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span>  <span class="comment">// android.view.View$OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> MainActivity.<span class="built_in">this</span>.edt.getText().toString();</span><br><span class="line">                <span class="keyword">if</span>(MainActivity.<span class="built_in">this</span>.cmpstr(s) == <span class="number">1</span>) &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;YEY YOU GOT THE FLAG &quot;</span> + s, <span class="number">1</span>).show();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;TRY AGAIN&quot;</span>, <span class="number">1</span>).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>ActivityMainBinding</code>只是一个和改变布局控件相关的辅助函数，即 Android <strong>ViewBinding（视图绑定）</strong> 自动生成的辅助类，可能是系统自动生成，无需理会。注意看关键比较逻辑，和cmpstr函数进行了比较，这个函数在native层，典型的需要用IDA分析so层。</p>
<p>JEB提取library目录下的arm64-v8a下的so文件，或者直接解压apk在lib文件夹找到此so文件， 用IDA打开。因为这是主要考察Frida，so层不会做一些CTF题考察的混淆等，可以放心分析啦！</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> __fastcall <span class="title function_">Java_com_ad2001_frida0x8_MainActivity_cmpstr</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [xsp+20h] [xbp-C0h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [xsp+24h] [xbp-BCh]</span></span><br><span class="line">  <span class="type">char</span> *s1; <span class="comment">// [xsp+30h] [xbp-B0h]</span></span><br><span class="line">  <span class="type">char</span> s2[<span class="number">100</span>]; <span class="comment">// [xsp+74h] [xbp-6Ch] BYREF</span></span><br><span class="line">  __int64 v10; <span class="comment">// [xsp+D8h] [xbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v10 = *(_QWORD *)(_ReadStatusReg(TPIDR_EL0) + <span class="number">40</span>);</span><br><span class="line">  s1 = (<span class="type">char</span> *)_JNIEnv::GetStringUTFChars(a1, a3, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; __strlen_chk(<span class="string">&quot;GSJEB|OBUJWF`MBOE~&quot;</span>, <span class="number">0xFFFFFFFFFFFFFFFFL</span>L); ++i )</span><br><span class="line">    s2[i] = aGsjebObujwfMbo[i] - <span class="number">1</span>;</span><br><span class="line">  s2[__strlen_chk(<span class="string">&quot;GSJEB|OBUJWF`MBOE~&quot;</span>, <span class="number">0xFFFFFFFFFFFFFFFFL</span>L)] = <span class="number">0</span>;</span><br><span class="line">  v4 = <span class="built_in">strcmp</span>(s1, s2);</span><br><span class="line">  __android_log_print(<span class="number">3</span>, <span class="string">&quot;input &quot;</span>, <span class="string">&quot;%s&quot;</span>, s1);</span><br><span class="line">  __android_log_print(<span class="number">3</span>, <span class="string">&quot;Password&quot;</span>, <span class="string">&quot;%s&quot;</span>, s2);</span><br><span class="line">  _JNIEnv::ReleaseStringUTFChars(a1, a3, s1);</span><br><span class="line">  _ReadStatusReg(TPIDR_EL0);</span><br><span class="line">  <span class="keyword">return</span> v4 == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上是IDA分析得到的函数，关键函数就在for循环里面，for循环之后s2最后一位给了0，也就是简单的加密操作。解密之后，利用v4进行C原生态字符串比较函数的操作。而拦截strcmp参数会得到解密后的数据，这就给了我们hook的可乘之机。</p>
<p>我们注意到函数会打印一个password，这个就是加密后的字符串，应该就是flag。这里学习一下使用Frida hook native层的方法。</p>
<p>想要hook native层函数，难度比hook java大得多，所使用的API也比较复杂。</p>
<p>根据官方题解来看，我们想要hook native层的方法，可使用Interceptor这个API。它的简单用法如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通用模板</span></span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(目标函数地址/符号, &#123;</span><br><span class="line">    <span class="comment">// 1. onEnter：函数被调用时触发（进入函数前），可读取/修改参数</span></span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>) &#123;</span><br><span class="line">        <span class="comment">// args：参数数组，args[0] 是第一个参数，args[1] 是第二个，依此类推</span></span><br><span class="line">        <span class="comment">// this.context：CPU 上下文（寄存器状态，比如 arm64 的 x0-x30，x86 的 eax/ebx 等）</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;函数被调用，参数1：&quot;</span>, args[<span class="number">0</span>]);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 2. onLeave：函数执行完成后触发（返回前），可读取/修改返回值</span></span><br><span class="line">    <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params">retval</span>) &#123;</span><br><span class="line">        <span class="comment">// retval：原函数的返回值（NativePointer 类型）</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;函数返回值：&quot;</span>, retval);</span><br><span class="line">        <span class="comment">// 修改返回值：直接给 retval 赋值</span></span><br><span class="line">        retval.<span class="title function_">replace</span>(<span class="number">0x1</span>); <span class="comment">// 将返回值改为 1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>其实简单来看，语法模板和Java.choose差不多，只不过第一个是目标native函数符号了，而不是java类名。native层hook就复杂在这个地方，我们需要调用其他函数来找到目标函数地址。具体的可参考这位的博客：[Frida Native层Hook学习笔记 - gla2xy’s blog](<a target="_blank" rel="noopener" href="https://gal2xy.github.io/2024/07/29/Frida">https://gal2xy.github.io/2024/07/29/Frida</a> Hook&#x2F;Frida Native层Hook学习笔记&#x2F;#调用native函数)，我感觉我一下子也记不住，以后拉屎的时候顺带看一眼得了，现在只是介绍这个题目所需要的API。</p>
<p>在此之前，先介绍一下导入表和导出表的区别：导出表是 “我提供给别人用的函数 &#x2F; 符号”，导入表是 “我需要从别人那里拿的函数 &#x2F; 符号”</p>
<table>
<thead>
<tr>
<th>维度</th>
<th>导出表（Export Table）</th>
<th>导入表（Import Table）</th>
</tr>
</thead>
<tbody><tr>
<td><strong>核心作用</strong></td>
<td>对外暴露本文件的函数 &#x2F; 变量（供其他文件调用）</td>
<td>声明本文件需要调用的、其他文件的函数 &#x2F; 变量</td>
</tr>
<tr>
<td><strong>所属文件</strong></td>
<td>被依赖的文件（比如系统库 libc.so、自定义 libtest.so）</td>
<td>依赖别人的文件（比如你的业务 libapp.so）</td>
</tr>
<tr>
<td><strong>存储内容</strong></td>
<td>函数名 &#x2F; 符号名、函数地址、序号等</td>
<td>要调用的函数名、对应的依赖库名（比如 libc.so）</td>
</tr>
<tr>
<td><strong>使用场景</strong></td>
<td>其他文件通过导出表找到并调用本文件的函数</td>
<td>本文件加载时，系统根据导入表找到并绑定外部函数</td>
</tr>
<tr>
<td><strong>Frida 中用途</strong></td>
<td><code>Module.getExportByName(&quot;libxxx.so&quot;, &quot;func&quot;)</code> 找函数地址</td>
<td>逆向时分析文件依赖（比如 libapp.so 依赖哪些系统函数）</td>
</tr>
<tr>
<td><strong>是否可缺失</strong></td>
<td>纯依赖型文件（无对外函数）可无导出表</td>
<td>无外部依赖的文件（比如纯静态逻辑）可无导入表</td>
</tr>
</tbody></table>
<p>我们想要找到so的地址，就是找到导出表，<code>Module.enumerateExports()</code>能打包所有的导出表函数，这个方法会返回一个元组。具体实例如下所示：来源于我上文提到的博客</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> imports = <span class="title class_">Module</span>.<span class="title function_">enumerateImports</span>(<span class="string">&#x27;libart.so&#x27;</span>);<span class="comment">//同目录下的动态库</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> iterator <span class="keyword">of</span> imports) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(iterator));<span class="comment">//转成json格式</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们要获取地址，就得选择：findExportByName</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const funcAddr = Module.findExportByName(&#x27;libart.so&#x27;, &#x27;_ZN9unix_file6FdFile5WriteEPKcll&#x27;);</span><br><span class="line">console.log(funcAddr);</span><br></pre></td></tr></table></figure>

<p>getExportByName同<code>findExportByName</code>。区别是find找不到会返回null，get则会报错。</p>
<p>有时候我们实在找不到这些函数的地址（可能因为没有加载等）可以使用Module.getBaseAddress()方法，返回基地址之后，在IDA里面看到偏移，就能获取到想要的函数的地址。</p>
<p>当然这道题不需要太复杂，因为能直接找到想要的函数！</p>
<p>首先我们获取所有的导出函数，看看我们掌握了API用法没。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> all_ex = <span class="title class_">Module</span>.<span class="title function_">enumerateExports</span>(<span class="string">&quot;libfrida0x8.so&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(all_ex, <span class="literal">null</span>, <span class="number">2</span>));<span class="comment">//用于格式化输出</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>得到以下输出，看到cmpstr了吗？这就是我们要hook的。</p>
<p><img src="image-20260215212710755.png" alt="image-20260215212710755"></p>
<p>其他API简单使用可以看图。</p>
<p><img src="image-20260215213124557.png" alt="image-20260215213124557"></p>
<p>我们需要注意下，函数的strcmp是外部导入的，显而易见来源于libc.so，我们在这里找这个函数地址才行。</p>
<p>借助onEnter即可获取参数，这里有一个小技巧，可以在onEnter搞一个固定参数用于判断进入的是不是我们需要的函数，是的话就能接着hook否则不进行hook。这里演示一下，其实这道题不需要这样也可以。</p>
<p>这里虽然我们主程序没有提示成功，但是我们已经拿到flag</p>
<p><img src="image-20260215214512767.png" alt="image-20260215214512767"></p>
<p>exp：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> strcmp = <span class="title class_">Module</span>.<span class="title function_">getExportByName</span>(<span class="string">&quot;libc.so&quot;</span>, <span class="string">&quot;strcmp&quot;</span>);</span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(strcmp, &#123;</span><br><span class="line">  <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">    <span class="comment">//观察是否有关键字符串</span></span><br><span class="line">    <span class="keyword">var</span> arg = args[<span class="number">0</span>].<span class="title function_">readCString</span>();<span class="comment">//转换字符串</span></span><br><span class="line">    <span class="comment">//还可以用 Memory.readUtf8String(args[0])</span></span><br><span class="line">    <span class="keyword">var</span> arg2 = args[<span class="number">1</span>].<span class="title function_">readCString</span>();</span><br><span class="line">    <span class="keyword">if</span> (arg.<span class="title function_">includes</span>(<span class="string">&quot;babyface&quot;</span>)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;args1:&quot;</span> + arg + <span class="string">&quot;\nargs2:&quot;</span> + arg2);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//这个加不加都行</span></span><br><span class="line">  <span class="comment">// onLeave: function (retval) &#123;</span></span><br><span class="line">  <span class="comment">//   return retval;</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Frida-0x9"><a href="#Frida-0x9" class="headerlink" title="Frida 0x9"></a>Frida 0x9</h2><p>只有一个click me按钮。还是进入JADX看一下。老是用JEB审美疲劳了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.a0x9;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> com.ad2001.a0x9.databinding.ActivityMainBinding;</span><br><span class="line"><span class="keyword">import</span> java.security.InvalidKeyException;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.BadPaddingException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.IllegalBlockSizeException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.NoSuchPaddingException;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes3.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ActivityMainBinding binding;</span><br><span class="line">    Button btn;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">int</span> <span class="title function_">check_flag</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;a0x9&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="type">ActivityMainBinding</span> <span class="variable">activityMainBindingInflate</span> <span class="operator">=</span> ActivityMainBinding.inflate(getLayoutInflater());</span><br><span class="line">        <span class="built_in">this</span>.binding = activityMainBindingInflate;</span><br><span class="line">        setContentView(activityMainBindingInflate.getRoot());</span><br><span class="line">        <span class="type">Button</span> <span class="variable">button</span> <span class="operator">=</span> (Button) findViewById(C0549R.id.button);</span><br><span class="line">        <span class="built_in">this</span>.btn = button;</span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123; <span class="comment">// from class: com.ad2001.a0x9.MainActivity.1</span></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> <span class="keyword">throws</span> NoSuchPaddingException, NoSuchAlgorithmException, InvalidKeyException &#123;</span><br><span class="line">                <span class="keyword">if</span> (MainActivity.<span class="built_in">this</span>.check_flag() == <span class="number">1337</span>) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES&quot;</span>);</span><br><span class="line">                        <span class="type">SecretKeySpec</span> <span class="variable">secretKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(<span class="string">&quot;3000300030003003&quot;</span>.getBytes(), <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            cipher.init(<span class="number">2</span>, secretKeySpec);</span><br><span class="line">                            <span class="type">byte</span>[] decryptedBytes = Base64.getDecoder().decode(<span class="string">&quot;hBCKKAqgxVhJMVTQS8JADelBUPUPyDiyO9dLSS3zho0=&quot;</span>);</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                <span class="type">String</span> <span class="variable">decrypted</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(cipher.doFinal(decryptedBytes));</span><br><span class="line">                                Toast.makeText(MainActivity.<span class="built_in">this</span>.getApplicationContext(), <span class="string">&quot;You won &quot;</span> + decrypted, <span class="number">1</span>).show();</span><br><span class="line">                                <span class="keyword">return</span>;</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (BadPaddingException e) &#123;</span><br><span class="line">                                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (IllegalBlockSizeException e2) &#123;</span><br><span class="line">                                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e2);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (InvalidKeyException e3) &#123;</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e3);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e4) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e4);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (NoSuchPaddingException e5) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e5);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                Toast.makeText(MainActivity.<span class="built_in">this</span>.getApplicationContext(), <span class="string">&quot;Try again&quot;</span>, <span class="number">1</span>).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其实很明显看出来是需要我们hook 返回值的，现在去IDA看一下相关函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">Java_com_ad2001_a0x9_MainActivity_check_1flag</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那很显而易见，需要hook返回值。</p>
<p>老办法，先打印出来所有的lib层函数，再来分析目标libc函数地址</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> libfunc = <span class="title class_">Module</span>.<span class="title function_">enumerateExports</span>(<span class="string">&quot;liba0x9.so&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(libfunc, <span class="literal">null</span>, <span class="number">2</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其实观察也能看出来这个和IDA的名字一模一样。</p>
<p><img src="image-20260216222915286.png" alt="image-20260216222915286"></p>
<p>下面用上文提及的Interceptor即可hook</p>
<p>刚好借此机会介绍一下retval和args的区别。如下所示：</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>args（函数入参）</th>
<th>retval（返回值）</th>
</tr>
</thead>
<tbody><tr>
<td>类型</td>
<td>数组（<code>NativePointer</code>数组）</td>
<td>单个 <code>InvocationReturnValue</code> 对象</td>
</tr>
<tr>
<td>触发时机</td>
<td><code>onEnter</code> 阶段（函数刚调用）</td>
<td><code>onLeave</code> 阶段（函数执行完）</td>
</tr>
<tr>
<td>替换操作</td>
<td>直接赋值修改数组元素</td>
<td>调用 <code>replace()</code> 方法替换值</td>
</tr>
<tr>
<td>代表含义</td>
<td>函数的输入参数（多个）</td>
<td>函数的返回结果（单个）</td>
</tr>
</tbody></table>
<p>因此我们替换和打印就有所区别。args和数组操作一样，retval的替换是replace方法，而打印存在toInt32和toString方法。相信看到名字就能理解这个方法的作用了，可以使用下看看输出结果，详细见下图</p>
<p><img src="image-20260216223920598.png" alt="image-20260216223920598"></p>
<p>exp如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// var libfunc = Module.enumerateExports(&quot;liba0x9.so&quot;);</span></span><br><span class="line"><span class="comment">// console.log(JSON.stringify(libfunc, null, 2));</span></span><br><span class="line"><span class="keyword">var</span> libc = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(</span><br><span class="line">  <span class="string">&quot;liba0x9.so&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Java_com_ad2001_a0x9_MainActivity_check_1flag&quot;</span>,</span><br><span class="line">);</span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(libc, &#123;</span><br><span class="line">  <span class="comment">// onEnter: function (args) &#123;&#125;,</span></span><br><span class="line">  <span class="comment">//上面这个加不加都可以</span></span><br><span class="line">  <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">    retval.<span class="title function_">replace</span>(<span class="number">0x539</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(retval + <span class="string">&quot;\n&quot;</span> + retval.<span class="title function_">toInt32</span>());</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>而且由于是点击按钮触发，附加模式hook即可。</p>
<h2 id="Frida-0xA"><a href="#Frida-0xA" class="headerlink" title="Frida 0xA"></a>Frida 0xA</h2><p>雷电模拟器闪退，只能看静态代码了。</p>
<p>静态代码没有和应用退出相关的代码，看了WP应该是安卓11以上可以运行，师傅们可以配一个高版本安卓模拟器，我这小菜菜就不折腾了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0xa;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> androidx.constraintlayout.widget.ConstraintLayout;</span><br><span class="line"><span class="keyword">import</span> com.ad2001.frida0xa.databinding.ActivityMainBinding;</span><br><span class="line"><span class="keyword">import</span> kotlin.Metadata;</span><br><span class="line"><span class="keyword">import</span> kotlin.jvm.internal.Intrinsics;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* compiled from: MainActivity.kt */</span></span><br><span class="line"><span class="meta">@Metadata(m126d1 = &#123;&quot;\u0000&amp;\n\u0002\u0018\u0002\n\u0002\u0018\u0002\n\u0002\b\u0002\n\u0002\u0018\u0002\n\u0000\n\u0002\u0010\u0002\n\u0000\n\u0002\u0018\u0002\n\u0000\n\u0002\u0010\u000e\n\u0002\b\u0002\u0018\u0000 \u000b2\u00020\u0001:\u0001\u000bB\u0005¢\u0006\u0002\u0010\u0002J\u0012\u0010\u0005\u001a\u00020\u00062\b\u0010\u0007\u001a\u0004\u0018\u00010\bH\u0014J\t\u0010\t\u001a\u00020\nH\u0086 R\u000e\u0010\u0003\u001a\u00020\u0004X\u0082.¢\u0006\u0002\n\u0000¨\u0006\f&quot;&#125;, m127d2 = &#123;&quot;Lcom/ad2001/frida0xa/MainActivity;&quot;, &quot;Landroidx/appcompat/app/AppCompatActivity;&quot;, &quot;()V&quot;, &quot;binding&quot;, &quot;Lcom/ad2001/frida0xa/databinding/ActivityMainBinding;&quot;, &quot;onCreate&quot;, &quot;&quot;, &quot;savedInstanceState&quot;, &quot;Landroid/os/Bundle;&quot;, &quot;stringFromJNI&quot;, &quot;&quot;, &quot;Companion&quot;, &quot;app_debug&quot;&#125;, m128k = 1, m129mv = &#123;1, 8, 0&#125;, m131xi = ConstraintLayout.LayoutParams.Table.LAYOUT_CONSTRAINT_VERTICAL_CHAINSTYLE)</span></span><br><span class="line"><span class="comment">/* loaded from: classes4.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ActivityMainBinding binding;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> String <span class="title function_">stringFromJNI</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="type">ActivityMainBinding</span> <span class="variable">activityMainBindingInflate</span> <span class="operator">=</span> ActivityMainBinding.inflate(getLayoutInflater());</span><br><span class="line">        Intrinsics.checkNotNullExpressionValue(activityMainBindingInflate, <span class="string">&quot;inflate(layoutInflater)&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.binding = activityMainBindingInflate;</span><br><span class="line">        <span class="type">ActivityMainBinding</span> <span class="variable">activityMainBinding</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (activityMainBindingInflate == <span class="literal">null</span>) &#123;</span><br><span class="line">            Intrinsics.throwUninitializedPropertyAccessException(<span class="string">&quot;binding&quot;</span>);</span><br><span class="line">            activityMainBindingInflate = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        setContentView(activityMainBindingInflate.getRoot());</span><br><span class="line">        <span class="type">ActivityMainBinding</span> <span class="variable">activityMainBinding2</span> <span class="operator">=</span> <span class="built_in">this</span>.binding;</span><br><span class="line">        <span class="keyword">if</span> (activityMainBinding2 == <span class="literal">null</span>) &#123;</span><br><span class="line">            Intrinsics.throwUninitializedPropertyAccessException(<span class="string">&quot;binding&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            activityMainBinding = activityMainBinding2;</span><br><span class="line">        &#125;</span><br><span class="line">        activityMainBinding.sampleText.setText(stringFromJNI());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;frida0xa&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一整个onCreate方法就是一个控件的替换操作，因此可以不看了。</p>
<p>主要是static，这是一个静态块，静态块能保证 “类一加载就加载 SO 库”，且只加载一次（避免重复加载浪费资源），是 JNI 开发的标准写法。我们去IDA看看内容：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">Java_com_ad2001_frida0xa_MainActivity_stringFromJNI</span><span class="params">(_JNIEnv *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v1; <span class="comment">// x0</span></span><br><span class="line">  __int64 v3; <span class="comment">// [xsp+18h] [xbp-48h]</span></span><br><span class="line">  _BYTE v5[<span class="number">24</span>]; <span class="comment">// [xsp+40h] [xbp-20h] BYREF</span></span><br><span class="line">  __int64 v6; <span class="comment">// [xsp+58h] [xbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = *(_QWORD *)(_ReadStatusReg(TPIDR_EL0) + <span class="number">40</span>);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string&lt;decltype(nullptr)&gt;();</span><br><span class="line">  v1 = (<span class="type">const</span> <span class="type">char</span> *)sub_1DD3C(v5);</span><br><span class="line">  v3 = _JNIEnv::NewStringUTF(a1, v1);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(v5);</span><br><span class="line">  _ReadStatusReg(TPIDR_EL0);</span><br><span class="line">  <span class="keyword">return</span> v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到没什么内容。这里有一个小心得，逆向的时候可以多工具联合使用，打开ghidra第一眼就看到了get_flag函数，而且ghidra还能分析出stringFromJNI函数的实际反汇编：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">undefined8 <span class="title function_">Java_com_ad2001_frida0xa_MainActivity_stringFromJNI</span><span class="params">(_JNIEnv *param_1)</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">long</span> lVar1;</span><br><span class="line">  <span class="type">char</span> *pcVar2;</span><br><span class="line">  undefined8 uVar3;</span><br><span class="line">  basic_string&lt;&gt; abStack_30 [<span class="number">24</span>];</span><br><span class="line">  <span class="type">long</span> local_18;</span><br><span class="line">  </span><br><span class="line">  lVar1 = tpidr_el0;</span><br><span class="line">  local_18 = *(<span class="type">long</span> *)(lVar1 + <span class="number">0x28</span>);</span><br><span class="line">  <span class="built_in">std</span>::__ndk1::basic_string&lt;&gt;::basic_string&lt;&gt;(abStack_30,<span class="string">&quot;Hello Hackers&quot;</span>);</span><br><span class="line">  pcVar2 = (<span class="type">char</span> *)FUN_0011dd3c(abStack_30);</span><br><span class="line">                    <span class="comment">/* try &#123; // try from 0011dc2c to 0011dc2f has its CatchHandler @ 0011dc68 */</span></span><br><span class="line">  uVar3 = _JNIEnv::NewStringUTF(param_1,pcVar2);</span><br><span class="line">  <span class="built_in">std</span>::__ndk1::basic_string&lt;&gt;::~basic_string(abStack_30);</span><br><span class="line">  lVar1 = tpidr_el0;</span><br><span class="line">  lVar1 = *(<span class="type">long</span> *)(lVar1 + <span class="number">0x28</span>) - local_18;</span><br><span class="line">  <span class="keyword">if</span> (lVar1 == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> uVar3;</span><br><span class="line">  &#125;</span><br><span class="line">                    <span class="comment">/* WARNING: Subroutine does not return */</span></span><br><span class="line">  __stack_chk_fail(lVar1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>那明显就是设置程序开场的文本，估计就是Hello Hackers</p>
<p>突发奇想看看binaryninja这个软件能不能看到关键函数</p>
<p>可以看到对这道题而言实际效果不是太理想</p>
<p><img src="image-20260216225726980.png" alt="image-20260216225726980"></p>
<p>IDA分析get_flag函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">get_flag</span><span class="params">(__int64 result, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [xsp+Ch] [xbp-44h]</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">20</span>]; <span class="comment">// [xsp+34h] [xbp-1Ch] BYREF</span></span><br><span class="line">  __int64 v4; <span class="comment">// [xsp+48h] [xbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = *(_QWORD *)(_ReadStatusReg(TPIDR_EL0) + <span class="number">40</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (_DWORD)result + a2 == <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; __strlen_chk(<span class="string">&quot;FPE&gt;9q8A&gt;BK-)20A-#Y&quot;</span>, <span class="number">0xFFFFFFFFFFFFFFFFL</span>L); ++i )</span><br><span class="line">      v3[i] = aFpe9q8aBk20aY[i] + <span class="number">2</span> * i;</span><br><span class="line">    v3[<span class="number">19</span>] = <span class="number">0</span>;</span><br><span class="line">    result = __android_log_print(<span class="number">3</span>, <span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;Decrypted Flag: %s&quot;</span>, v3);</span><br><span class="line">  &#125;</span><br><span class="line">  _ReadStatusReg(TPIDR_EL0);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>get_flag参数是两个数字，相加&#x3D;3就解密并且弹出flag</p>
<p>注意，这在Java程序没有被引用，这不是so的导出函数，想要获取他的地址只能用上文（0x8）介绍的基地址+偏移的方式，但是当时没有认真分析，现在是认真分析了。</p>
<p>还需要说一下<code>__android_log_print</code>是输出信息到控制台，我们可以hook这个函数，看它的参数，但是这个实现恐怕特别复杂，我们不如直接在adb shell看日志。这个后话，先主动调用函数。</p>
<p>如果对这种方式感兴趣，可以看一下这位大佬博客：<br><a target="_blank" rel="noopener" href="https://gi1gamesh666.github.io/2025/09/07/frida-labs-WP/#0xA">frida-labs WP - APT114514</a></p>
<p>首先获取libc基地址，IDA查找偏移，就是这个native函数的地址。这里需要用add()方法增加偏移</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> base_addr = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libfrida0xa.so&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(base_addr);</span><br><span class="line"><span class="keyword">var</span> libc = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libfrida0xa.so&quot;</span>).<span class="title function_">add</span>(<span class="number">0x1db80</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(libc);</span><br></pre></td></tr></table></figure>

<p>基地址获取还有另外一种方式，这就是枚举模块名称的思路。豆包说的，利用Process：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;========== 已加载的所有模块 ==========&quot;</span>);</span><br><span class="line"><span class="title class_">Process</span>.<span class="title function_">enumerateModules</span>(&#123;</span><br><span class="line">  <span class="comment">// 可选：过滤出以lib开头的库，避免显示系统无关模块</span></span><br><span class="line">  <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params"><span class="variable language_">module</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`模块名: <span class="subst">$&#123;<span class="variable language_">module</span>.name&#125;</span>`</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`  路径: <span class="subst">$&#123;<span class="variable language_">module</span>.path&#125;</span>`</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`  基地址: <span class="subst">$&#123;<span class="variable language_">module</span>.base&#125;</span>`</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`  大小: 0x<span class="subst">$&#123;<span class="variable language_">module</span>.size.toString(<span class="number">16</span>)&#125;</span> 字节`</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;----------------------------------&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;✅ 模块枚举完成&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后需要new一个nativePointer对象，传入目标函数地址</p>
<p>然后需要new一个nativeFunction对象，需要先传入一个nativePointer对象，第二个参数是返回值，第三个以后的参数就是依次的原本参数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> point = <span class="keyword">new</span> <span class="title class_">NativePointer</span>(libc);</span><br><span class="line"><span class="keyword">var</span> func = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(point, <span class="string">&quot;void&quot;</span>, [<span class="string">&quot;int&quot;</span>, <span class="string">&quot;int&quot;</span>]);</span><br><span class="line"><span class="title function_">func</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>每一步打印出来相关值，是写代码的好习惯，方便迅速溯源到出错位置。</p>
<p>我安装了夜神模拟器防止闪退。需要注意这里要用夜神12版本，且adb用文件夹自带的nox_adb.exe</p>
<p><img src="image-20260216234613216.png" alt="image-20260216234613216"></p>
<p>然后用-f参数，即spawn模式启动我们的app</p>
<p>假如报错：not a function，说明偏移找错了。如下是我们的模拟器偏移，因此我就找错了偏移，应该分析x64文件夹下面的so文件</p>
<p><img src="image-20260216235730075.png" alt="image-20260216235730075"></p>
<p>但是实际调试发现，偏移还是在X86看的，后面用夜神测试是X86_64地址，怀疑是雷电当时出bug了。</p>
<p>学到0xb之后，我们可以读指定内存汇编指令，快速查看是否找对了so偏移，不必担心，无非多试几次。</p>
<p>这里用-F启动，即attach，避免出现因为libc未加载就hook而导致基地址为null</p>
<p>adb查看日志：用logcat，-s后面跟要搜的字符串，这里用flag</p>
<table>
<thead>
<tr>
<th>命令片段</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>adb</code></td>
<td>Android Debug Bridge 的缩写，是安卓调试桥工具，用于电脑和安卓设备 &#x2F; 模拟器通信</td>
</tr>
<tr>
<td><code>-s 127.0.0.1:5555</code></td>
<td>指定调试的目标设备 &#x2F; 模拟器（<code>-s</code> &#x3D; serial number，序列号 &#x2F; 地址）127.0.0.1:5555 是本地安卓模拟器的默认调试端口（比如 Android Studio 的模拟器）</td>
</tr>
<tr>
<td><code>logcat</code></td>
<td>adb 的子命令，用于查看安卓系统 &#x2F; APP 的运行日志（相当于安卓的「控制台输出」）</td>
</tr>
<tr>
<td><code>-s FLAG</code></td>
<td>过滤日志（<code>-s</code> &#x3D; silent，静默模式，只显示指定标签的日志）「FLAG」是日志的「标签（Tag）」，只打印 Tag 为 FLAG 的日志</td>
</tr>
</tbody></table>
<p>完整exp：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> base_addr = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libfrida0xa.so&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(base_addr);</span><br><span class="line"><span class="keyword">var</span> libc = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libfrida0xa.so&quot;</span>).<span class="title function_">add</span>(<span class="number">0x1dd60</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(libc);</span><br><span class="line"><span class="keyword">var</span> point = <span class="keyword">new</span> <span class="title class_">NativePointer</span>(libc);</span><br><span class="line"><span class="keyword">var</span> func = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(point, <span class="string">&quot;void&quot;</span>, [<span class="string">&quot;int&quot;</span>, <span class="string">&quot;int&quot;</span>]);</span><br><span class="line"><span class="title function_">func</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="image-20260217001441529.png" alt="image-20260217001441529"></p>
<h2 id="加餐：查看寄存器的值"><a href="#加餐：查看寄存器的值" class="headerlink" title="加餐：查看寄存器的值"></a>加餐：查看寄存器的值</h2><p>在onEnter加一个this.context即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(hookAddr, &#123;</span><br><span class="line">        <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;onEnter: &#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">context</span>))</span><br><span class="line">            <span class="comment">// console.log(&#x27;rax: &#x27;, this.context.rax)</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;&#125;,</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>



<h2 id="Frida-0xB"><a href="#Frida-0xB" class="headerlink" title="Frida 0xB"></a>Frida 0xB</h2><p>首先这道题也闪退，那么打开安卓12！</p>
<p>这道题目上强度了，而且作为so层函数，不会那么简单就让你hook的，和IDA反编译一样，必须得知道对应的字节，然后反编译，那就得要求操作内存数据，赋予相关的可执行权限。这倒不是主要的，可写权限才是最重要的，因为我们需要patch字节。</p>
<p>可以看到启动的时候会调用get_flag</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ad2001.frida0xb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> androidx.constraintlayout.widget.ConstraintLayout;</span><br><span class="line"><span class="keyword">import</span> com.ad2001.frida0xb.databinding.ActivityMainBinding;</span><br><span class="line"><span class="keyword">import</span> kotlin.Metadata;</span><br><span class="line"><span class="keyword">import</span> kotlin.jvm.internal.Intrinsics;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* compiled from: MainActivity.kt */</span></span><br><span class="line"><span class="meta">@Metadata(m126d1 = &#123;&quot;\u0000\&quot;\n\u0002\u0018\u0002\n\u0002\u0018\u0002\n\u0002\b\u0002\n\u0002\u0018\u0002\n\u0000\n\u0002\u0010\u0002\n\u0002\b\u0002\n\u0002\u0018\u0002\n\u0002\b\u0002\u0018\u0000 \n2\u00020\u0001:\u0001\nB\u0005¢\u0006\u0002\u0010\u0002J\t\u0010\u0005\u001a\u00020\u0006H\u0086 J\u0012\u0010\u0007\u001a\u00020\u00062\b\u0010\b\u001a\u0004\u0018\u00010\tH\u0014R\u000e\u0010\u0003\u001a\u00020\u0004X\u0082.¢\u0006\u0002\n\u0000¨\u0006\u000b&quot;&#125;, m127d2 = &#123;&quot;Lcom/ad2001/frida0xb/MainActivity;&quot;, &quot;Landroidx/appcompat/app/AppCompatActivity;&quot;, &quot;()V&quot;, &quot;binding&quot;, &quot;Lcom/ad2001/frida0xb/databinding/ActivityMainBinding;&quot;, &quot;getFlag&quot;, &quot;&quot;, &quot;onCreate&quot;, &quot;savedInstanceState&quot;, &quot;Landroid/os/Bundle;&quot;, &quot;Companion&quot;, &quot;app_debug&quot;&#125;, m128k = 1, m129mv = &#123;1, 8, 0&#125;, m131xi = ConstraintLayout.LayoutParams.Table.LAYOUT_CONSTRAINT_VERTICAL_CHAINSTYLE)</span></span><br><span class="line"><span class="comment">/* loaded from: classes3.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ActivityMainBinding binding;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">getFlag</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="type">ActivityMainBinding</span> <span class="variable">activityMainBindingInflate</span> <span class="operator">=</span> ActivityMainBinding.inflate(getLayoutInflater());</span><br><span class="line">        Intrinsics.checkNotNullExpressionValue(activityMainBindingInflate, <span class="string">&quot;inflate(layoutInflater)&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.binding = activityMainBindingInflate;</span><br><span class="line">        <span class="keyword">if</span> (activityMainBindingInflate == <span class="literal">null</span>) &#123;</span><br><span class="line">            Intrinsics.throwUninitializedPropertyAccessException(<span class="string">&quot;binding&quot;</span>);</span><br><span class="line">            activityMainBindingInflate = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        setContentView(activityMainBindingInflate.getRoot());</span><br><span class="line">        <span class="type">View</span> <span class="variable">viewFindViewById</span> <span class="operator">=</span> findViewById(C0548R.id.button);</span><br><span class="line">        Intrinsics.checkNotNullExpressionValue(viewFindViewById, <span class="string">&quot;findViewById(R.id.button)&quot;</span>);</span><br><span class="line">        <span class="type">Button</span> <span class="variable">btn</span> <span class="operator">=</span> (Button) viewFindViewById;</span><br><span class="line">        btn.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123; <span class="comment">// from class: com.ad2001.frida0xb.MainActivity$$ExternalSyntheticLambda0</span></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line">                MainActivity.onCreate$lambda$<span class="number">0</span>(<span class="built_in">this</span>.f$<span class="number">0</span>, view);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* JADX INFO: Access modifiers changed from: private */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> onCreate$lambda$<span class="number">0</span>(MainActivity <span class="built_in">this</span>$<span class="number">0</span>, View it) &#123;</span><br><span class="line">        Intrinsics.checkNotNullParameter(<span class="built_in">this</span>$<span class="number">0</span>, <span class="string">&quot;this$0&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>$<span class="number">0.</span>getFlag();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;frida0xb&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还是调用了一个get_flag</p>
<p>IDA F5不起作用了，看汇编存在干扰指令：<br><img src="image-20260217002155229.png" alt="image-20260217002155229"></p>
<p>我们nop之</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">Java_com_ad2001_frida0xb_MainActivity_getFlag</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v0; <span class="comment">// [rsp+8h] [rbp-48h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 i_1; <span class="comment">// [rsp+10h] [rbp-40h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 i; <span class="comment">// [rsp+20h] [rbp-30h]</span></span><br><span class="line"></span><br><span class="line">  i_1 = __strlen_chk(<span class="string">&quot;j~ehmWbmxezisdmogi~Q&quot;</span>, <span class="number">-1</span>);</span><br><span class="line">  v0 = (<span class="type">char</span> *)operator new[](i_1 + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; i_1; ++i )</span><br><span class="line">    v0[i] = aJEhmwbmxezisdm[i] ^ <span class="number">0x2C</span>;</span><br><span class="line">  v0[i] = <span class="number">0</span>;</span><br><span class="line">  __android_log_print(<span class="number">3</span>, <span class="string">&quot;FLAG :&quot;</span>, <span class="string">&quot;%s&quot;</span>, v0);</span><br><span class="line">  <span class="keyword">if</span> ( v0 )</span><br><span class="line">    operator delete[](v0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于ghrida来说，可以取消勾选下图选项</p>
<p><img src="image-20260217002512084.png" alt="image-20260217002512084"></p>
<p>得到代码，汇编主逻辑不变，就是nop判断句。这是执行的时候的关键所在</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Java_com_ad2001_frida0xb_MainActivity_getFlag</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  uint uVar1;</span><br><span class="line">  <span class="type">void</span> *pvVar2;</span><br><span class="line">  uint local_18;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">false</span>) &#123;</span><br><span class="line">    uVar1 = __strlen_chk(<span class="string">&quot;j~ehmWbmxezisdmogi~Q&quot;</span>,<span class="number">0xffffffff</span>);</span><br><span class="line">    pvVar2 = operator.new[](uVar1 + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (local_18 = <span class="number">0</span>; local_18 &lt; uVar1; local_18 = local_18 + <span class="number">1</span>) &#123;</span><br><span class="line">      *(byte *)((<span class="type">int</span>)pvVar2 + local_18) = <span class="string">&quot;j~ehmWbmxezisdmogi~Q&quot;</span>[local_18] ^ <span class="number">0x2c</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    *(undefined1 *)((<span class="type">int</span>)pvVar2 + local_18) = <span class="number">0</span>;</span><br><span class="line">    __android_log_print(<span class="number">3</span>,<span class="string">&quot;FLAG :&quot;</span>,&amp;DAT_0001687e,pvVar2);</span><br><span class="line">    <span class="keyword">if</span> (pvVar2 != (<span class="type">void</span> *)<span class="number">0x0</span>) &#123;</span><br><span class="line">      operator.delete[](pvVar2);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由此可见只需要nop一个判断才行，最终FLAG就会被打印在安卓日志上面。</p>
<p>现在给大家介绍几个API接口用于操作native层的函数。</p>
<p>刚才已经介绍过，我们需要修改某片内存的权限以进行patch，这个操作需要用到<code>Memory.protect(DEADBEEF, 0x1000, &quot;rwx&quot;); </code>这个API，其中第一个是地址，第二个是size，第三个是权限，如果是只可以读写，就是<code>rw-</code></p>
<p>因为内存大小最小是页，即0x1000字节，我们写的时候参数是0x1000，第一个参数是目标地址就行</p>
<p>我们拿到一片text节内存地址，更希望打印出来其中的值，比如显示出附近的汇编语句之类的。这时候可以组合使用相关API，首推：</p>
<ul>
<li><code>Memory.readByteArray(addr, size)</code>用于读取部分内存地址的字节，返回一个字节数组</li>
<li><code>Instruction.parse( address)</code>传入一个指定地址，反编译此处指令为代码（能编译出一条完整指令为止）</li>
</ul>
<p>第二个API参数支持两种类型：</p>
<table>
<thead>
<tr>
<th>参数形式</th>
<th>语法</th>
<th>适用场景</th>
</tr>
</thead>
<tbody><tr>
<td>单参数形式</td>
<td><code>Instruction.parse(address)</code></td>
<td>直接从内存中读取并解析指定地址的<strong>单条完整指令</strong></td>
</tr>
<tr>
<td>双参数形式</td>
<td><code>Instruction.parse(address, bytes)</code></td>
<td>解析传入的字节数组（<code>bytes</code>），并关联到指定地址（<code>address</code>）</td>
</tr>
</tbody></table>
<p>这个组合使用就是读取内存处字节，我们关心代码，则再使用第二个API将他转化为代码。具体的例子如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> instructionBytes = <span class="title class_">Memory</span>.<span class="title function_">readByteArray</span>(<span class="variable constant_">DEADBEEF</span>, size);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;instructionBytes ：&quot;</span>,instructionBytes);</span><br><span class="line"><span class="comment">// 解析并输出汇编指令</span></span><br><span class="line"><span class="keyword">var</span> instructions = <span class="title class_">Instruction</span>.<span class="title function_">parse</span>(<span class="variable constant_">DEADBEEF</span>, instructionBytes);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;instructions ：&quot;</span>,instructions);</span><br></pre></td></tr></table></figure>

<p>如何patch字节呢？现在介绍一个专门用于patch字节的API</p>
<p>需注意架构区别！！！<code>arm</code>架构使用<code>Arm64Writer</code>修改，<code>x64</code>、<code>x86</code>架构使用<code>X86Writer</code>修改。</p>
<p>这里用X86Writer，传入一个地址实例化类即可，如下所示：<br><code>var writer = new X86Writer(DEADBEEF);</code></p>
<p>writer支持很多方法，我们常见的有：</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>作用</th>
<th>示例代码</th>
<th>对应汇编指令</th>
</tr>
</thead>
<tbody><tr>
<td><code>pushReg(reg)</code></td>
<td>寄存器入栈</td>
<td><code>writer.pushReg(regs.rax);</code></td>
<td><code>push rax</code></td>
</tr>
<tr>
<td><code>pushImm(imm)</code></td>
<td>立即数入栈</td>
<td><code>writer.pushImm(0x1234);</code></td>
<td><code>push 0x1234</code></td>
</tr>
<tr>
<td><code>popReg(reg)</code></td>
<td>出栈到寄存器</td>
<td><code>writer.popReg(regs.rax);</code></td>
<td><code>pop rax</code></td>
</tr>
<tr>
<td><code>putCall(addr)</code></td>
<td>函数调用指令</td>
<td><code>writer.putCall(0x7ff6a1b2c000);</code></td>
<td><code>call 0x7ff6a1b2c000</code></td>
</tr>
<tr>
<td><code>putJmp(addr)</code></td>
<td>无条件跳转</td>
<td><code>writer.putJmp(0x7ff6a1b2c400);</code></td>
<td><code>jmp 0x7ff6a1b2c400</code></td>
</tr>
<tr>
<td><code>putNop()</code></td>
<td>写入 1 字节空指令（nop），用于占位 &#x2F; 替换指令</td>
<td><code>writer.putNop();</code></td>
<td><code>nop</code></td>
</tr>
<tr>
<td><code>putRet()</code></td>
<td>写入返回指令（ret），函数返回时用</td>
<td><code>writer.putRet();</code></td>
<td><code>ret</code></td>
</tr>
<tr>
<td><code>putRetImm(imm)</code></td>
<td>带立即数的 ret（ret n），返回时调整栈指针</td>
<td><code>writer.putRetImm(0x8);</code></td>
<td><code>ret 0x8</code></td>
</tr>
<tr>
<td><code>putByte([])</code></td>
<td>写入机器码</td>
<td><code>writer.putBytes([0x75, 0x05]);</code></td>
<td>机器码对应的</td>
</tr>
</tbody></table>
<p>最终不要忘记<code>writer.flush();</code>刷新缓冲区</p>
<p>这里我们可以打开IDA的机器码显示，看看对应的机器码是多少。可以看到是6个，我们填充6个90就行</p>
<p><img src="image-20260217201122668.png" alt="image-20260217201122668"></p>
<p>然后根据0xa学到的知识点，主动调用native层函数就万事大吉了。</p>
<p>那我们先找到基地址，然后找到对应地址偏移，打印出代码看看是不是目标代码。上文介绍的Process模块其实特别方便</p>
<p>这里偏移是x64的so偏移</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> base;<span class="comment">//作用域提升</span></span><br><span class="line"><span class="title class_">Process</span>.<span class="title function_">enumerateModules</span>(&#123;</span><br><span class="line">  <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params"><span class="variable language_">module</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">module</span>.<span class="property">name</span> == <span class="string">&quot;libfrida0xb.so&quot;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;模块名：&quot;</span> + <span class="variable language_">module</span>.<span class="property">name</span> + <span class="string">&quot;基地址：&quot;</span> + <span class="variable language_">module</span>.<span class="property">base</span>);</span><br><span class="line">      base = <span class="variable language_">module</span>.<span class="property">base</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> offset = <span class="number">0x170ce</span>;</span><br><span class="line"><span class="keyword">var</span> target_addr = base.<span class="title function_">add</span>(offset);</span><br><span class="line"><span class="keyword">var</span> bytesArr = <span class="title class_">Memory</span>.<span class="title function_">readByteArray</span>(target_addr, <span class="number">6</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Instruction</span>.<span class="title function_">parse</span>(target_addr, bytesArr));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看到找对了</p>
<p><img src="image-20260217203613924.png" alt="image-20260217203613924"></p>
<p>现在开始修改字节，首先修改内存权限，然后开始执行patch，全填充个nop就行了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Memory</span>.<span class="title function_">protect</span>(target_addr, <span class="number">0x1000</span>, <span class="string">&quot;rwx&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> write = <span class="keyword">new</span> <span class="title function_">X86Writer</span>(target_addr);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">  write.<span class="title function_">putNop</span>();</span><br><span class="line">&#125;</span><br><span class="line">write.<span class="title function_">flush</span>();</span><br></pre></td></tr></table></figure>

<p>然后主动调用之</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> func_addr = base.<span class="title function_">add</span>(<span class="number">0x0170b0</span>);</span><br><span class="line"><span class="keyword">var</span> func_pr = <span class="keyword">new</span> <span class="title class_">NativePointer</span>(func_addr);</span><br><span class="line"><span class="keyword">var</span> func = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(func_pr, <span class="string">&quot;void&quot;</span>, []);</span><br><span class="line"><span class="title function_">func</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;done&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意看so这一个代码：<code>_android_log_print(3, &quot;FLAG :&quot;, &quot;%s&quot;, v0);</code>tag变了，所以我们看flag语句也变了，原来的语句会报错</p>
<p>具体指令见下图</p>
<p><img src="image-20260217204953499.png" alt="image-20260217204953499"></p>
<p>完结撒花，谢谢大家观看！</p>
<p>完整exp：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> base;</span><br><span class="line"><span class="title class_">Process</span>.<span class="title function_">enumerateModules</span>(&#123;</span><br><span class="line">  <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params"><span class="variable language_">module</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">module</span>.<span class="property">name</span> == <span class="string">&quot;libfrida0xb.so&quot;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;模块名：&quot;</span> + <span class="variable language_">module</span>.<span class="property">name</span> + <span class="string">&quot;基地址：&quot;</span> + <span class="variable language_">module</span>.<span class="property">base</span>);</span><br><span class="line">      base = <span class="variable language_">module</span>.<span class="property">base</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> offset = <span class="number">0x170ce</span>;</span><br><span class="line"><span class="keyword">var</span> target_addr = base.<span class="title function_">add</span>(offset);</span><br><span class="line"><span class="keyword">var</span> bytesArr = <span class="title class_">Memory</span>.<span class="title function_">readByteArray</span>(target_addr, <span class="number">6</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Instruction</span>.<span class="title function_">parse</span>(target_addr, bytesArr));</span><br><span class="line"><span class="title class_">Memory</span>.<span class="title function_">protect</span>(target_addr, <span class="number">0x1000</span>, <span class="string">&quot;rwx&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> write = <span class="keyword">new</span> <span class="title function_">X86Writer</span>(target_addr);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">  write.<span class="title function_">putNop</span>();</span><br><span class="line">&#125;</span><br><span class="line">write.<span class="title function_">flush</span>();</span><br><span class="line"><span class="keyword">var</span> func_addr = base.<span class="title function_">add</span>(<span class="number">0x0170b0</span>);</span><br><span class="line"><span class="keyword">var</span> func_pr = <span class="keyword">new</span> <span class="title class_">NativePointer</span>(func_addr);</span><br><span class="line"><span class="keyword">var</span> func = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(func_pr, <span class="string">&quot;void&quot;</span>, []);</span><br><span class="line"><span class="title function_">func</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;done&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://wlmt666.top">胡楚昊</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://wlmt666.top/2026/02/12/frida-labs%E9%80%9A%E5%85%B3%E7%AC%94%E8%AE%B0/">https://wlmt666.top/2026/02/12/frida-labs%E9%80%9A%E5%85%B3%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://wlmt666.top" target="_blank">wlmt666的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="../../../../tags/ctf/">ctf</a><a class="post-meta__tags" href="../../../../tags/reverse/">reverse</a><a class="post-meta__tags" href="../../../../tags/frida/">frida</a></div><div class="post-share"><div class="social-share" data-image="../../../../img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="../../../01/30/2025%E6%98%A5%E7%A7%8B%E6%9D%AF%E5%86%AC%E5%AD%A3%E8%B5%9Bwriteup/" title="2025春秋杯冬季赛writeup"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">2025春秋杯冬季赛writeup</div></div><div class="info-2"><div class="info-item-1">蒸了三天，最终排名：102 这次二进制题目略少，不过对我来说我都不会，唉  BinSecure Gate这个很明显是移动逆向，也很好理解，只是异或算法 主要加密代码： 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package com.icqctf.signcheck;import android.os.Bundle;import android.view.View;import android.widget.Button;import android.widget.TextView;import androidx.appcompat.app.AppCompatActivity;import androidx.core.internal.view.SupportMenu;/* loaded from: classes.dex */public class MainActivity extends AppCompatActivity...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="../../../../2025/06/30/%E4%B8%80%E9%81%93EzTea%EF%BC%8C%E5%BE%88%E6%9C%89%E4%BB%B7%E5%80%BC%E7%9A%84%E9%A2%98%E7%9B%AE/" title="一道EzTea，很有价值的题目"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-30</div><div class="info-item-2">一道EzTea，很有价值的题目</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a><a class="pagination-related" href="../../../../2025/09/09/angr%E5%AD%A6%E4%B9%A0/" title="angr学习"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-09</div><div class="info-item-2">angr学习</div></div><div class="info-2"><div class="info-item-1">angr符号执行框架，是我一直想要理解学习的，今天就来实际学习体验一下。 根据网上教的，应该是在GitHub - jakespringer&#x2F;angr_ctf 网站上面下载对应的习题，编写对应的python进行练习。 前置要求：安装angr库，我已经满足，接下来就开始进行捣鼓。 angr的原理我也不太能解释清楚，所以直接开干吧。（默认python代码均引入angr库） 因此，使用 angr 一般分为如下步骤：  创建 Project，预设 state 创建位向量和符号变量，保存在内存&#x2F;寄存器&#x2F;文件或其他地方（简单的题目直接可以省略） 将 state 添加到 SM 中 运行，探索满足条件的路径 约束求解获取执行结果  1-angr-find用这个作为入门吧。分析一下代码： 1234567891011121314151617int __cdecl main(int argc, const char **argv, const char **envp)&#123;  int i; // [esp+1Ch] [ebp-1Ch]  char s1[9]; //...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="../img/butterfly-icon.png" onerror="this.onerror=null;this.src='../img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">胡楚昊</div><div class="author-info-description">热爱网安的菜鸟一枚</div><div class="site-data"><a href="../archives/"><div class="headline">文章</div><div class="length-num">9</div></a><a href="../tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/"><div class="headline">分类</div><div class="length-num">6</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/wlmt666"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">热爱网安的菜鸟一枚</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%89%93%E9%9D%B6"><span class="toc-number">2.</span> <span class="toc-text">打靶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida-0x1"><span class="toc-number">2.1.</span> <span class="toc-text">Frida 0x1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida-0x2"><span class="toc-number">2.2.</span> <span class="toc-text">Frida 0x2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida-0x3"><span class="toc-number">2.3.</span> <span class="toc-text">Frida 0x3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF1"><span class="toc-number">2.3.1.</span> <span class="toc-text">思路1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%B7%AF2"><span class="toc-number">2.3.2.</span> <span class="toc-text">思路2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida-0x4"><span class="toc-number">2.4.</span> <span class="toc-text">Frida 0x4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida-0x5"><span class="toc-number">2.5.</span> <span class="toc-text">Frida 0x5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida-0x6"><span class="toc-number">2.6.</span> <span class="toc-text">Frida 0x6</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida-0x7"><span class="toc-number">2.7.</span> <span class="toc-text">Frida 0x7</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E9%A4%90-hook-java%E5%8F%82%E6%95%B0"><span class="toc-number">2.8.</span> <span class="toc-text">加餐 hook java参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida-0x8"><span class="toc-number">2.9.</span> <span class="toc-text">Frida 0x8</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida-0x9"><span class="toc-number">2.10.</span> <span class="toc-text">Frida 0x9</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida-0xA"><span class="toc-number">2.11.</span> <span class="toc-text">Frida 0xA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E9%A4%90%EF%BC%9A%E6%9F%A5%E7%9C%8B%E5%AF%84%E5%AD%98%E5%99%A8%E7%9A%84%E5%80%BC"><span class="toc-number">2.12.</span> <span class="toc-text">加餐：查看寄存器的值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Frida-0xB"><span class="toc-number">2.13.</span> <span class="toc-text">Frida 0xB</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="../2026/02/12/frida-labs%E9%80%9A%E5%85%B3%E7%AC%94%E8%AE%B0/" title="frida-labs通关笔记">frida-labs通关笔记</a><time datetime="2026-02-12T08:47:45.000Z" title="发表于 2026-02-12 16:47:45">2026-02-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="../2026/01/30/2025%E6%98%A5%E7%A7%8B%E6%9D%AF%E5%86%AC%E5%AD%A3%E8%B5%9Bwriteup/" title="2025春秋杯冬季赛writeup">2025春秋杯冬季赛writeup</a><time datetime="2026-01-30T02:37:37.000Z" title="发表于 2026-01-30 10:37:37">2026-01-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="../2025/12/23/%E5%8D%8E%E4%B8%BA%E9%B8%BF%E8%92%99%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0/" title="华为鸿蒙开发学习">华为鸿蒙开发学习</a><time datetime="2025-12-23T13:47:55.000Z" title="发表于 2025-12-23 21:47:55">2025-12-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="../2025/12/23/PWN%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E%E5%88%9D%E6%8E%A2/" title="PWN的格式化字符串漏洞初探">PWN的格式化字符串漏洞初探</a><time datetime="2025-12-23T07:41:54.000Z" title="发表于 2025-12-23 15:41:54">2025-12-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="../2025/12/23/git%E5%AD%A6%E4%B9%A0/" title="git学习">git学习</a><time datetime="2025-12-23T07:41:39.000Z" title="发表于 2025-12-23 15:41:39">2025-12-23</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent;"><div id="footer-wrap"><div class="copyright">&copy;2025 - 2026 By 胡楚昊</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="../../../../js/utils.js"></script><script src="../../../../js/main.js"></script><div class="js-pjax"></div><script type="text/javascript" src="/js/wlmt666.js"></script><script type="text/javascript" src="/js/sakura.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>