<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>一道EzTea，很有价值的题目 | wlmt666的博客</title><meta name="author" content="胡楚昊"><meta name="copyright" content="胡楚昊"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="初探明明之前了解过Tea相关的逆向题目，但是做题却屡屡受挫，就拿这道题目来说，十分让我失望，不能说没有思路，只能说一点思路都没有。我下定决心和他死磕到底，期末考试都不再复习了。 首先打开EXE文件，就是让输入东西，明显是校验输入。这里就不再截图了，下面进入IDA一探究竟。 声明：参考了DASCTF-NOVX联合出题人2022年度积分榜争夺赛，且分析部分可以直接略过。 0x01分析 这是main函数">
<meta property="og:type" content="article">
<meta property="og:title" content="一道EzTea，很有价值的题目">
<meta property="og:url" content="https://wlmt666.github.io/2025/06/30/%E4%B8%80%E9%81%93EzTea%EF%BC%8C%E5%BE%88%E6%9C%89%E4%BB%B7%E5%80%BC%E7%9A%84%E9%A2%98%E7%9B%AE/index.html">
<meta property="og:site_name" content="wlmt666的博客">
<meta property="og:description" content="初探明明之前了解过Tea相关的逆向题目，但是做题却屡屡受挫，就拿这道题目来说，十分让我失望，不能说没有思路，只能说一点思路都没有。我下定决心和他死磕到底，期末考试都不再复习了。 首先打开EXE文件，就是让输入东西，明显是校验输入。这里就不再截图了，下面进入IDA一探究竟。 声明：参考了DASCTF-NOVX联合出题人2022年度积分榜争夺赛，且分析部分可以直接略过。 0x01分析 这是main函数">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wlmt666.github.io/img/butterfly-icon.png">
<meta property="article:published_time" content="2025-06-30T12:05:52.000Z">
<meta property="article:modified_time" content="2025-12-23T08:16:13.813Z">
<meta property="article:author" content="胡楚昊">
<meta property="article:tag" content="reverse">
<meta property="article:tag" content="tea">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wlmt666.github.io/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "一道EzTea，很有价值的题目",
  "url": "https://wlmt666.github.io/2025/06/30/%E4%B8%80%E9%81%93EzTea%EF%BC%8C%E5%BE%88%E6%9C%89%E4%BB%B7%E5%80%BC%E7%9A%84%E9%A2%98%E7%9B%AE/",
  "image": "https://wlmt666.github.io/img/butterfly-icon.png",
  "datePublished": "2025-06-30T12:05:52.000Z",
  "dateModified": "2025-12-23T08:16:13.813Z",
  "author": [
    {
      "@type": "Person",
      "name": "胡楚昊",
      "url": "https://wlmt666.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="../../../../img/favicon.png"><link rel="canonical" href="https://wlmt666.github.io/2025/06/30/%E4%B8%80%E9%81%93EzTea%EF%BC%8C%E5%BE%88%E6%9C%89%E4%BB%B7%E5%80%BC%E7%9A%84%E9%A2%98%E7%9B%AE/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="../../../../css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '一道EzTea，很有价值的题目',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/modify.css"><link rel="stylesheet" href="/css/wlmt666.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/background.jpg);"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="../../../../index.html"><span class="site-name">wlmt666的博客</span></a><a class="nav-page-title" href="../../../../index.html"><span class="site-name">一道EzTea，很有价值的题目</span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">一道EzTea，很有价值的题目</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-06-30T12:05:52.000Z" title="发表于 2025-06-30 20:05:52">2025-06-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-12-23T08:16:13.813Z" title="更新于 2025-12-23 16:16:13">2025-12-23</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="初探"><a href="#初探" class="headerlink" title="初探"></a>初探</h1><p>明明之前了解过Tea相关的逆向题目，但是做题却屡屡受挫，就拿这道题目来说，十分让我失望，不能说没有思路，只能说一点思路都没有。我下定决心和他死磕到底，期末考试都不再复习了。</p>
<p>首先打开EXE文件，就是让输入东西，明显是校验输入。这里就不再截图了，下面进入IDA一探究竟。</p>
<p><strong>声明：参考了<a target="_blank" rel="noopener" href="https://bexh0lder.github.io/2022/11/29/DASCTF-NOVX%E8%81%94%E5%90%88%E5%87%BA%E9%A2%98%E4%BA%BA2022%E5%B9%B4%E5%BA%A6%E7%A7%AF%E5%88%86%E6%A6%9C%E4%BA%89%E5%A4%BA%E8%B5%9B/">DASCTF-NOVX联合出题人2022年度积分榜争夺赛</a>，且分析部分可以直接略过。</strong></p>
<h1 id="0x01分析"><a href="#0x01分析" class="headerlink" title="0x01分析"></a>0x01分析</h1><p><img src="image-20250630201241710.png" alt="image-20250630201241710"></p>
<p>这是main函数，显然逻辑还是比较清晰，何况我也已经修改了部分变量名。接下来就是着重看for循环里的这个加密函数。看看里面究竟搞了什么。</p>
<p><img src="image-20250630201415709.png" alt="image-20250630201415709"></p>
<p>表面上来看就是做了普普通通的加密，参考了WP之后才发觉内有玄机。这也提醒了我，以后遇到类似题目，也不要忘记粗略审查一些汇编代码，说不定哪里就出现了和题解有关的东西。这道题就是汇编藏了捕获异常的代码，这部分是不会被反汇编为伪C的，我们需要自己识别。</p>
<h2 id="第一处："><a href="#第一处：" class="headerlink" title="第一处："></a>第一处：</h2><p><img src="image-20250630202220499.png" alt="image-20250630202220499"></p>
<p>寄存器edx被复制为var24，并且进行了异或1234567h，var24就是偏移的意思，通过审查发现其就是魔数相加的地方。我们看看loc_401127发生了什么，换言之就是什么情况会触发这个异常。</p>
<p><img src="image-20250630202710134.png" alt="image-20250630202710134"></p>
<p>看这个地方，首先将ecx赋值为v5，也就是魔数相加的那个变量，之后右移0x1F，由于最后一行的idiv ecx操作数是ecx，ecx在这里表示除数，如果值为0显然会抛出异常，也就是说，v5如果&gt;&gt;0x1F&#x3D;&#x3D;0，会进行异或1234567h。</p>
<h2 id="第二处："><a href="#第二处：" class="headerlink" title="第二处："></a>第二处：</h2><p><img src="image-20250630202953791.png" alt="image-20250630202953791"></p>
<p>这个是进行了赋值指令，这两个分别对应加密函数for循环内的v6和v7，这里是把这两个值赋值给了这两片内存区域，那么触发这个异常的条件是什么呢？</p>
<p><img src="image-20250630203401179.png" alt="image-20250630203401179"></p>
<p>就是上图，这TryLevel本身也是程序异常处理机制的一部分，这个值会在异常发生时被用于确定异常处理的上下文。根据上文有个for循环控制这行代码来看，其实就是实现了一个循环估计，接下来看下一处，这个先不必理会。</p>
<p><strong>其实这里有大用！我给忽略了</strong></p>
<p>看起来没有下一处了，那么其实很明显，代码相加的时候，会额外考虑是否是&gt;&gt;0x1F&#x3D;&#x3D;0，对于逆向者来说，又该怎么考虑呢？</p>
<h1 id="0x2开干"><a href="#0x2开干" class="headerlink" title="0x2开干"></a>0x2开干</h1><p>我们逆向的时候，一定是让魔数从大到小变化，正向来看，魔数满足条件就会变化，逆向来看，我们应该考虑到在某次循环的时候，魔数已经变化了，并且将它值改变为正确的，举个例子，正向第三次循环魔数由0变成1，那么倒着第三轮的时候我们因该知道这时候魔数需要变化。其实就是在每轮解密之前加一个校验即可。</p>
<h2 id="第一次错误！"><a href="#第一次错误！" class="headerlink" title="第一次错误！"></a>第一次错误！</h2><p>源码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _DWORD unsigned int</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">encrypto</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *input, _DWORD *key)</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> result;    <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> i;      <span class="comment">// [esp+20h] [ebp-28h]</span></span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> v5;      <span class="comment">// [esp+24h] [ebp-24h]</span></span><br><span class="line"></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [esp+28h] [ebp-20h]</span></span><br><span class="line"></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// [esp+2Ch] [ebp-1Ch]</span></span><br><span class="line"></span><br><span class="line">  v7 = *input;</span><br><span class="line"></span><br><span class="line">  v6 = input[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; ++i)</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">​    v5 += <span class="number">0x9E3779B1</span>;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">if</span> (v5 &gt;&gt; <span class="number">0x1f</span> == <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">​    &#123;</span><br><span class="line"></span><br><span class="line">​      v5 ^= <span class="number">0x123456</span>;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    v7 += (key[<span class="number">1</span>] + (v6 &gt;&gt; <span class="number">5</span>)) ^ (v5 + v6) ^ (*key + <span class="number">16</span> * v6);</span><br><span class="line"></span><br><span class="line">​    v6 += (key[<span class="number">3</span>] + (v7 &gt;&gt; <span class="number">5</span>)) ^ (v5 + v7) ^ (key[<span class="number">2</span>] + <span class="number">16</span> * v7);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  *input = v7;</span><br><span class="line"></span><br><span class="line">  result = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">  input[<span class="number">1</span>] = v6;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">decrypto</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *input, _DWORD *key)</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> result;    <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> i;      <span class="comment">// [esp+20h] [ebp-28h]</span></span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> v5;      <span class="comment">// [esp+24h] [ebp-24h]</span></span><br><span class="line"></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [esp+28h] [ebp-20h]</span></span><br><span class="line"></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// [esp+2Ch] [ebp-1Ch]</span></span><br><span class="line"></span><br><span class="line">  v7 = *input;</span><br><span class="line"></span><br><span class="line">  v6 = input[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">​    v5 += <span class="number">0x9E3779B1</span>;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">32</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">​    v6 += (key[<span class="number">3</span>] + (v7 &gt;&gt; <span class="number">5</span>)) ^ (v5 + v7) ^ (key[<span class="number">2</span>] + <span class="number">16</span> * v7);</span><br><span class="line"></span><br><span class="line">​    v7 += (key[<span class="number">1</span>] + (v6 &gt;&gt; <span class="number">5</span>)) ^ (v5 + v6) ^ (*key + <span class="number">16</span> * v6);</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">if</span> (v5 &gt;&gt; <span class="number">0x1f</span> == <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">​    &#123;</span><br><span class="line"></span><br><span class="line">​      v5 ^= <span class="number">0x123456</span>;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    v5 -= <span class="number">0x9E3779B1</span>;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  *input = v7;</span><br><span class="line"></span><br><span class="line">  result = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">  input[<span class="number">1</span>] = v6;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> crypto[] = &#123;<span class="number">48</span>, <span class="number">181</span>, <span class="number">39</span>, <span class="number">94</span>, <span class="number">243</span>, <span class="number">247</span>, <span class="number">190</span>, <span class="number">189</span>, <span class="number">143</span>, <span class="number">106</span>, <span class="number">81</span>, <span class="number">227</span>, <span class="number">254</span>, <span class="number">108</span>, <span class="number">131</span>, <span class="number">93</span>, <span class="number">9</span>, <span class="number">250</span>, <span class="number">61</span>, <span class="number">216</span>, <span class="number">122</span>, <span class="number">115</span>, <span class="number">252</span>, <span class="number">142</span>, <span class="number">163</span>, <span class="number">83</span>, <span class="number">168</span>, <span class="number">85</span>, <span class="number">197</span>, <span class="number">78</span>, <span class="number">86</span>, <span class="number">122</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> key[] = &#123;<span class="number">1</span>, <span class="number">35</span>, <span class="number">69</span>, <span class="number">103</span>, <span class="number">137</span>, <span class="number">171</span>, <span class="number">205</span>, <span class="number">239</span>, <span class="number">254</span>, <span class="number">220</span>, <span class="number">186</span>, <span class="number">152</span>, <span class="number">118</span>, <span class="number">84</span>, <span class="number">50</span>, <span class="number">16</span>&#125;;</span><br><span class="line"></span><br><span class="line">  decrypto((_DWORD *)crypto, (_DWORD *)key);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>很显然是不对的，调试看数组就能看出来，明显不是可见ASCII范围，看看人家高手的WP，我看看我问题出在哪里。</p>
<h2 id="纠错！"><a href="#纠错！" class="headerlink" title="纠错！"></a>纠错！</h2><p>很明显分析的步骤出了问题。看别人可以通过patch的方式，还原整个算法过程，所以我也来进行patch尝试，显然是由于异常执行语句的位置，决定了不能够被hex_rays反编译，我们尝试清除这部分内容看看。</p>
<p>注意，patch的时候，目标地址&#x3D;基地址+指令长度+偏移量。call、jmp后面四个字节跟的是地址！但是有时候我按照这个算出来的有问题，还是自己一个个尝试出来的。</p>
<p>第一处修改：<br><img src="image-20250704163719071.png" alt="image-20250704163719071"></p>
<p>第二处修改：</p>
<p>这里发现使用keyPatch插件事半功倍！</p>
<p><img src="image-20250704164305318.png" alt="image-20250704164305318"></p>
<p>第三处修改：</p>
<p><img src="image-20250704164345989.png" alt="image-20250704164345989"></p>
<p>再次按下F5即可!</p>
<h1 id="0x3终焉"><a href="#0x3终焉" class="headerlink" title="0x3终焉"></a>0x3终焉</h1><p>至此，真的代码已经浮出水面：</p>
<p>（根据前面的分析，异或0x1234567只有在&gt;&gt;31&#x3D;&#x3D;0时执行,我自己添加了一个判断条件）</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __scrt_is_nonwritable_in_current_image(<span class="type">unsigned</span> <span class="type">int</span> a1, <span class="type">unsigned</span> <span class="type">int</span> *a2, _DWORD *a3)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+20h] [ebp-28h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp+24h] [ebp-24h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [esp+28h] [ebp-20h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// [esp+2Ch] [ebp-1Ch]</span></span><br><span class="line"></span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v7 = dword_41F038 ^ *a2;</span><br><span class="line">  v6 = dword_41F03C ^ a2[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; a1; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span>(v5&gt;&gt;<span class="number">31</span>==<span class="number">0</span>)&#123;</span><br><span class="line">         v5 = (dword_41F000 + v5) ^ <span class="number">0x1234567</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        v5 = (dword_41F000 + v5)</span><br><span class="line">    &#125;</span><br><span class="line">    v7 += (a3[<span class="number">1</span>] + (v6 &gt;&gt; <span class="number">5</span>)) ^ (v5 + v6) ^ (*a3 + <span class="number">16</span> * v6);</span><br><span class="line">    v6 += (a3[<span class="number">3</span>] + (v7 &gt;&gt; <span class="number">5</span>)) ^ (v5 + v7) ^ (a3[<span class="number">2</span>] + <span class="number">16</span> * v7);</span><br><span class="line">  &#125;</span><br><span class="line">  dword_41F038 = v7;</span><br><span class="line">  dword_41F03C = v6;</span><br><span class="line">  *a2 = v7;</span><br><span class="line">  result = <span class="number">4</span>;</span><br><span class="line">  a2[<span class="number">1</span>] = v6;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据main函数写出解密函数时候，有个问题：魔数的和该怎么求？</p>
<p>可以抽象为一个问题：一个数字，进行循环运算（在特定情况下会进行特殊运算），最终有个和。如何根据这个和和这个条件，反推出每一轮的数字的值呢？</p>
<p>再具体一点，假设1经过3轮自增1计算，只有最后一轮+0.最终和为3.设最后一轮运算为x特殊运算，我们倒退的时候就知道在这里是+0，所以3-0，即3进行特殊运算。由此可得，如果有特殊运算，倒着运算的时候会计算一次。</p>
<p>回到这个题目，初始化的时候，我们要进行这个运算（如果满足&gt;&gt;31&#x3D;&#x3D;0)，否则解密的时候，会进行一次解密计算，如果符合条件，会进行异或，不考虑这个初始化运算，会影响以后每一轮的魔数，进而影响解密。</p>
<p>每一轮异或的就是上一轮的加密结果，只需要套用即可。</p>
<p>查阅一圈，感觉只能看懂这位大佬的：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Air_cat/article/details/128077351">DASCTF NOV - re - babytea - writeup_babytea ctf re-CSDN博客</a></p>
<p>解密代码如下（抄的上面的）：（动调也能拿数据，但是我暂时没学会）</p>
<p>来源于众多网络WP呀！</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">from ctypes import *</span><br><span class="line"></span><br><span class="line">sign = []</span><br><span class="line">sum = c_uint32(<span class="number">0</span>)</span><br><span class="line">d1 = <span class="number">0x1234567</span></span><br><span class="line">d2 = <span class="number">0x89ABCDEF</span></span><br><span class="line"><span class="keyword">for</span> i in range(<span class="number">32</span>):</span><br><span class="line">    delta = <span class="number">0x9E3779B1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (sum.value + delta) &amp; <span class="number">0x80000000</span> == <span class="number">0</span>:</span><br><span class="line">        sign.append(<span class="number">1</span>)</span><br><span class="line">        sum.value += delta</span><br><span class="line">        sum.value ^= <span class="number">0x1234567</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        sign.append(<span class="number">0</span>)</span><br><span class="line">        sum.value += delta</span><br><span class="line"></span><br><span class="line">def encrypt(v, k):</span><br><span class="line">    v0, v1 = c_uint32(v[<span class="number">0</span>]), c_uint32(v[<span class="number">1</span>])</span><br><span class="line">    delta = <span class="number">0x9E3779B1</span></span><br><span class="line">    k0, k1, k2, k3 = k[<span class="number">0</span>], k[<span class="number">1</span>], k[<span class="number">2</span>], k[<span class="number">3</span>]</span><br><span class="line">    v0.value ^= <span class="number">0x1234567</span></span><br><span class="line">    v1.value ^= <span class="number">0x89ABCDEF</span></span><br><span class="line">    total = c_uint32(<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i in range(<span class="number">32</span>):</span><br><span class="line">        <span class="meta">#print(hex(v0.value))</span></span><br><span class="line">        total.value += delta</span><br><span class="line">        <span class="keyword">if</span> sign[i] == <span class="number">1</span>:</span><br><span class="line">            total.value ^= <span class="number">0x1234567</span></span><br><span class="line">        v0.value += ((v1.value &lt;&lt; <span class="number">4</span>) + k0) ^ (v1.value +</span><br><span class="line">                                              total.value) ^ ((v1.value &gt;&gt; <span class="number">5</span>) + k1)</span><br><span class="line">        v1.value += ((v0.value &lt;&lt; <span class="number">4</span>) + k2) ^ (v0.value +</span><br><span class="line">                                              total.value) ^ ((v0.value &gt;&gt; <span class="number">5</span>) + k3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> v0.value, v1.value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def decrypt(v, k):</span><br><span class="line">    v0, v1 = c_uint32(v[<span class="number">0</span>]), c_uint32(v[<span class="number">1</span>])</span><br><span class="line">    <span class="meta">#print(hex(v[0]), hex(v[1]))</span></span><br><span class="line">    delta = <span class="number">0x9E3779B1</span></span><br><span class="line">    k0, k1, k2, k3 = k[<span class="number">0</span>], k[<span class="number">1</span>], k[<span class="number">2</span>], k[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    total = c_uint32(<span class="number">0xc78e4d05</span>)</span><br><span class="line">    <span class="keyword">for</span> i in range(<span class="number">32</span>):</span><br><span class="line">        v1.value -= ((v0.value &lt;&lt; <span class="number">4</span>) + k2) ^ (v0.value +</span><br><span class="line">                                              total.value) ^ ((v0.value &gt;&gt; <span class="number">5</span>) + k3)</span><br><span class="line">        v0.value -= ((v1.value &lt;&lt; <span class="number">4</span>) + k0) ^ (v1.value +</span><br><span class="line">                                              total.value) ^ ((v1.value &gt;&gt; <span class="number">5</span>) + k1)</span><br><span class="line">        <span class="keyword">if</span> sign[<span class="number">31</span>-i] == <span class="number">1</span>:</span><br><span class="line">            total.value ^= <span class="number">0x1234567</span></span><br><span class="line">        total.value -= delta</span><br><span class="line">    v0.value ^= d1</span><br><span class="line">    v1.value ^= d2</span><br><span class="line">    <span class="keyword">return</span> v0.value, v1.value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    context = [<span class="number">0x5E27B530</span>, <span class="number">0xBDBEF7F3</span>, <span class="number">0xE3516A8F</span>, <span class="number">0x5D836CFE</span>,</span><br><span class="line">               <span class="number">0xD83DFA09</span>, <span class="number">0x8EFC737A</span>, <span class="number">0x55A853A3</span>, <span class="number">0x7A564EC5</span>]</span><br><span class="line">    # 待加密的明文，两个<span class="number">32</span>位整型，即<span class="number">64b</span>it的明文数据</span><br><span class="line">    # 四个key，每个是<span class="number">32b</span>it，即密钥长度为<span class="number">128b</span>it</span><br><span class="line">    key = [<span class="number">0x67452301</span>, <span class="number">0xEFCDAB89</span>, <span class="number">0x98BADCFE</span>, <span class="number">0x10325476</span>]</span><br><span class="line">    # <span class="number">202</span>CB962AC59075B964B07152D234B70</span><br><span class="line">    flag = b<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="string">    for i in range(0, 4):</span></span><br><span class="line"><span class="string">        res = decrypt(context[i*2:i*2+2], key)</span></span><br><span class="line"><span class="string">        d1 = context[i*2]</span></span><br><span class="line"><span class="string">        d2 = context[i*2+1]</span></span><br><span class="line"><span class="string">        flag +=res[0].to_bytes(</span></span><br><span class="line"><span class="string">            4, &quot;little&quot;)+res[1].to_bytes(4, &quot;little&quot;)</span></span><br><span class="line"><span class="string">    print(flag)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p>如果用C语言，其实也能实现，但是我已经不想再搞这个题目，大概思路就是这样。下面这位大佬实现了，我也粘贴他的代码：</p>
<p><a target="_blank" rel="noopener" href="https://1manity.top/index.php/archives/62/">DASCTF NOV X联合出题人2022年度积分榜争夺赛 writeup - 1manityの秘密基地</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;cstdio&gt;</span><br><span class="line"></span><br><span class="line">unsigned long xor_key[] = &#123; 0x1234567,0x89ABCDEF &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void decrypt(unsigned long* v, unsigned long* k) &#123;</span><br><span class="line">    unsigned long y = v[0], z = v[1], sum = 0xC78E4D05;       </span><br><span class="line">    unsigned long delta = 0x9e3779b1;   </span><br><span class="line">              </span><br><span class="line">    unsigned long a = k[0], b = k[1], c = k[2], d = k[3];   </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    for (int i = 31; i &gt;= 0; i--) &#123;                     </span><br><span class="line">        z -= ((y &lt;&lt; 4) + c) ^ (y + sum) ^ ((y &gt;&gt; 5) + d);</span><br><span class="line">        y -= ((z &lt;&lt; 4) + a) ^ (z + sum) ^ ((z &gt;&gt; 5) + b);</span><br><span class="line">        /* end cycle */</span><br><span class="line">        if ((sum &gt;&gt; 0x1f) == 0) &#123;</span><br><span class="line">            sum ^= 0x1234567;</span><br><span class="line">        &#125;</span><br><span class="line">        sum -= delta;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    y ^= xor_key[0];</span><br><span class="line">    z ^= xor_key[1];</span><br><span class="line">    </span><br><span class="line">    v[0] = y;</span><br><span class="line">    v[1] = z;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    unsigned long enflag[] = &#123; 0x5E27B530,0xBDBEF7F3 ,0xE3516A8F,0x5D836CFE,0x0D83DFA09,0x8EFC737A,0x55A853A3,0x7A564EC5 &#125;;</span><br><span class="line">    unsigned long ori_enflag[] = &#123; 0x5E27B530,0xBDBEF7F3 ,0xE3516A8F,0x5D836CFE,0x0D83DFA09,0x8EFC737A,0x55A853A3,0x7A564EC5 &#125;;</span><br><span class="line">    unsigned long key[] = &#123; 0x67452301, 0xEFCDAB89, 0x98BADCFE, 0x10325476 &#125;;</span><br><span class="line"></span><br><span class="line">    printf(&quot;flag&#123;&quot;) ;</span><br><span class="line">    for (int i = 0; i &lt; 4; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        decrypt(&amp;enflag[i * 2], key);</span><br><span class="line">        </span><br><span class="line">        xor_key[0] = ori_enflag[2 * i]; xor_key[1] = ori_enflag[2 * i +1];</span><br><span class="line">        </span><br><span class="line">        for (int j = 0; j &lt; 4; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            printf(&quot;%c&quot;, enflag[i * 2] % 0x100);</span><br><span class="line">            enflag[i * 2] &gt;&gt;= 8;</span><br><span class="line">        &#125;</span><br><span class="line">        for (int j = 0; j &lt; 4; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            printf(&quot;%c&quot;, enflag[i * 2 + 1] % 0x100);</span><br><span class="line">            enflag[i * 2 + 1] &gt;&gt;= 8;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    printf(&quot;&#125;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://wlmt666.github.io">胡楚昊</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://wlmt666.github.io/2025/06/30/%E4%B8%80%E9%81%93EzTea%EF%BC%8C%E5%BE%88%E6%9C%89%E4%BB%B7%E5%80%BC%E7%9A%84%E9%A2%98%E7%9B%AE/">https://wlmt666.github.io/2025/06/30/%E4%B8%80%E9%81%93EzTea%EF%BC%8C%E5%BE%88%E6%9C%89%E4%BB%B7%E5%80%BC%E7%9A%84%E9%A2%98%E7%9B%AE/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://wlmt666.github.io" target="_blank">wlmt666的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="../../../../tags/reverse/">reverse</a><a class="post-meta__tags" href="../../../../tags/tea/">tea</a></div><div class="post-share"><div class="social-share" data-image="../../../../img/butterfly-icon.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="../../26/hello-world/" title="Hello World"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Hello World</div></div><div class="info-2"><div class="info-item-1">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot;  More info: Writing Run server1$ hexo server  More info: Server Generate static files1$ hexo generate  More info: Generating Deploy to remote sites1$ hexo deploy  More info:...</div></div></div></a><a class="pagination-related" href="../../../09/09/angr%E5%AD%A6%E4%B9%A0/" title="angr学习"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">angr学习</div></div><div class="info-2"><div class="info-item-1">angr符号执行框架，是我一直想要理解学习的，今天就来实际学习体验一下。 根据网上教的，应该是在GitHub - jakespringer&#x2F;angr_ctf 网站上面下载对应的习题，编写对应的python进行练习。 前置要求：安装angr库，我已经满足，接下来就开始进行捣鼓。 angr的原理我也不太能解释清楚，所以直接开干吧。（默认python代码均引入angr库） 因此，使用 angr 一般分为如下步骤：  创建 Project，预设 state 创建位向量和符号变量，保存在内存&#x2F;寄存器&#x2F;文件或其他地方（简单的题目直接可以省略） 将 state 添加到 SM 中 运行，探索满足条件的路径 约束求解获取执行结果  1-angr-find用这个作为入门吧。分析一下代码： 1234567891011121314151617int __cdecl main(int argc, const char **argv, const char **envp)&#123;  int i; // [esp+1Ch] [ebp-1Ch]  char s1[9]; //...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="../../../09/09/angr%E5%AD%A6%E4%B9%A0/" title="angr学习"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-09</div><div class="info-item-2">angr学习</div></div><div class="info-2"><div class="info-item-1">angr符号执行框架，是我一直想要理解学习的，今天就来实际学习体验一下。 根据网上教的，应该是在GitHub - jakespringer&#x2F;angr_ctf 网站上面下载对应的习题，编写对应的python进行练习。 前置要求：安装angr库，我已经满足，接下来就开始进行捣鼓。 angr的原理我也不太能解释清楚，所以直接开干吧。（默认python代码均引入angr库） 因此，使用 angr 一般分为如下步骤：  创建 Project，预设 state 创建位向量和符号变量，保存在内存&#x2F;寄存器&#x2F;文件或其他地方（简单的题目直接可以省略） 将 state 添加到 SM 中 运行，探索满足条件的路径 约束求解获取执行结果  1-angr-find用这个作为入门吧。分析一下代码： 1234567891011121314151617int __cdecl main(int argc, const char **argv, const char **envp)&#123;  int i; // [esp+1Ch] [ebp-1Ch]  char s1[9]; //...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="../../../../img/butterfly-icon.png" onerror="this.onerror=null;this.src='../../../../img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">胡楚昊</div><div class="author-info-description"></div><div class="site-data"><a href="../../../../archives/"><div class="headline">文章</div><div class="length-num">6</div></a><a href="../../../../tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="../../../../categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/wlmt666"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">热爱网安的菜鸟一枚</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9D%E6%8E%A2"><span class="toc-number">1.</span> <span class="toc-text">初探</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">0x01分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E5%A4%84%EF%BC%9A"><span class="toc-number">2.1.</span> <span class="toc-text">第一处：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%A4%84%EF%BC%9A"><span class="toc-number">2.2.</span> <span class="toc-text">第二处：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x2%E5%BC%80%E5%B9%B2"><span class="toc-number">3.</span> <span class="toc-text">0x2开干</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AC%A1%E9%94%99%E8%AF%AF%EF%BC%81"><span class="toc-number">3.1.</span> <span class="toc-text">第一次错误！</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%A0%E9%94%99%EF%BC%81"><span class="toc-number">3.2.</span> <span class="toc-text">纠错！</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x3%E7%BB%88%E7%84%89"><span class="toc-number">4.</span> <span class="toc-text">0x3终焉</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="../../../12/23/PWN%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E%E5%88%9D%E6%8E%A2/" title="PWN的格式化字符串漏洞初探">PWN的格式化字符串漏洞初探</a><time datetime="2025-12-23T07:41:54.000Z" title="发表于 2025-12-23 15:41:54">2025-12-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="../../../12/23/git%E5%AD%A6%E4%B9%A0/" title="git学习">git学习</a><time datetime="2025-12-23T07:41:39.000Z" title="发表于 2025-12-23 15:41:39">2025-12-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="../../../11/29/%E4%BB%8E0%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92%E7%9A%84%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%A8%A1%E5%9E%8B/" title="从0搭建一个线性回归的机器学习模型">从0搭建一个线性回归的机器学习模型</a><time datetime="2025-11-29T07:28:25.000Z" title="发表于 2025-11-29 15:28:25">2025-11-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="" title="angr学习">angr学习</a><time datetime="2025-09-09T11:29:25.000Z" title="发表于 2025-09-09 19:29:25">2025-09-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="../../../06/30/%E4%B8%80%E9%81%93EzTea%EF%BC%8C%E5%BE%88%E6%9C%89%E4%BB%B7%E5%80%BC%E7%9A%84%E9%A2%98%E7%9B%AE/" title="一道EzTea，很有价值的题目">一道EzTea，很有价值的题目</a><time datetime="2025-06-30T12:05:52.000Z" title="发表于 2025-06-30 20:05:52">2025-06-30</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent;"><div id="footer-wrap"><div class="copyright">&copy;2025 By 胡楚昊</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="../../../../js/utils.js"></script><script src="../../../../js/main.js"></script><div class="js-pjax"></div><script type="text/javascript" src="/js/wlmt666.js"></script><script type="text/javascript" src="/js/sakura.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>